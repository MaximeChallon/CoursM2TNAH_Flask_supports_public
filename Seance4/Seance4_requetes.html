<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>UE5 &colon; Fondamentaux du d&eacute;veloppement web frontal&comma; niveau 2</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

/* From extension marp-team.marp-vscode */
#__marp-vscode {
  all: initial;
}

/* Override VS Code default CSS rules reverting to initial
   https://github.com/microsoft/vscode/blob/master/src/vs/workbench/contrib/webview/browser/pre/main.js#L53 */
body.marp-vscode {
  padding: 0;
}

body.marp-vscode img {
  max-width: unset;
  max-height: unset;
}

body.marp-vscode a,
body.marp-vscode a:hover,
body.marp-vscode code {
  color: unset;
}

body.marp-vscode blockquote {
  background: unset;
  border-color: unset;
}

@media screen {
  body.marp-vscode {
    overflow-y: scroll;
  }

  #__marp-vscode [data-marp-vscode-slide-wrapper] {
    margin: 20px;
  }

  #__marp-vscode svg[data-marpit-svg] {
    box-shadow: 0 5px 10px rgb(0 0 0 / 25%);
    display: block;
    margin: 0;
  }

  /* Based on https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
  #code-csp-warning {
    background-color: #444;
    box-shadow: 1px 1px 1px rgb(0 0 0 / 25%);
    color: white;
    cursor: pointer;
    font-family: sans-serif;
    font-size: 12px;
    line-height: 22px;
    margin: 16px;
    padding: 6px;
    position: fixed;
    right: 0;
    text-align: center;
    top: 0;
    word-wrap: break-word;
  }

  #code-csp-warning:hover {
    text-decoration: none;
    background-color: #007acc;
    box-shadow: 2px 2px 2px rgb(0 0 0 / 25%);
  }
}

@media print {
  body.marp-vscode #code-csp-warning {
    display: none;
  }
}

/* From extension ms-toolsai.jupyter */
/* These classnames are inherited from bootstrap, but are present in most notebook renderers */

.alert {
    width: auto;
    padding: 1em;
    margin-top: 1em;
    margin-bottom: 1em;
}
.alert > *:last-child {
    margin-bottom: 0;
}
#preview > .alert:last-child {
    /* Prevent this being set to zero by the default notebook stylesheet */
    padding-bottom: 1em;
}

.alert-success {
    /* Note there is no suitable color available, so we just copy "info" */
    background-color: var(--theme-info-background);
    color: var(--theme-info-foreground);
}
.alert-info {
    background-color: var(--theme-info-background);
    color: var(--theme-info-foreground);
}
.alert-warning {
    background-color: var(--theme-warning-background);
    color: var(--theme-warning-foreground);
}
.alert-danger {
    background-color: var(--theme-error-background);
    color: var(--theme-error-foreground);
}

</style>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
        <style>
/*********************************************************************
This is free and unencumbered software released into the public domain.

Anyone is free to copy, modify, publish, use, compile, sell, or
distribute this software, either in source code form or as a compiled
binary, for any purpose, commercial or non-commercial, and by any
means.

For more information, please refer to <http://unlicense.org/>
*********************************************************************/

/*
WiTeX
https://github.com/AndrewBelt/WiTeX
*/


/* Latin Modern (LaTeX default) font */

@font-face {
	font-family: 'Latin Modern Roman';
	font-weight: normal;
	font-style: normal;
	src: url('https://cdn.rawgit.com/AndrewBelt/WiTeX/master/fonts/lmroman10-regular.woff') format('woff');
}

@font-face {
	font-family: 'Latin Modern Roman';
	font-weight: bold;
	font-style: normal;
	src: url('https://cdn.rawgit.com/AndrewBelt/WiTeX/master/fonts/lmroman10-bold.woff') format('woff');
}

@font-face {
	font-family: 'Latin Modern Roman';
	font-weight: normal;
	font-style: italic;
	src: url('https://cdn.rawgit.com/AndrewBelt/WiTeX/master/fonts/lmroman10-italic.woff') format('woff');
}

@font-face {
	font-family: 'Latin Modern Roman';
	font-weight: bold;
	font-style: italic;
	src: url('https://cdn.rawgit.com/AndrewBelt/WiTeX/master/fonts/lmroman10-bolditalic.woff') format('woff');
}

@font-face {
	font-family: 'Latin Modern Mono';
	font-weight: normal;
	font-style: normal;
	src: url('https://cdn.rawgit.com/AndrewBelt/WiTeX/master/fonts/lmmono10-regular.woff') format('woff');
}

@font-face {
	font-family: 'Latin Modern Mono';
	font-weight: normal;
	font-style: italic;
	src: url('https://cdn.rawgit.com/AndrewBelt/WiTeX/master/fonts/lmmono10-italic.woff') format('woff');
}

/* Page Layout */

body {
	background: none;
	font-size: 14pt;
	font-family: 'Latin Modern Roman', serif;
	color: black;
}

h1, h2, h3, h4, h5, h6 {
	border: none;
	font-weight: bold;
}

a, a:visited {
	color: #a00;
}

a.new, a.new:visited {
	color: black;
}

ul {
	list-style: disc;
}

#mw-navigation, #mw-page-base, #mw-head-base, #footer {
	/* nuke everything but the content */
	display: none;
}

/* Content Box */

.mw-body {
	max-width: 720px;
	margin: 1em auto;
}

#content, div#content {
	border: none;
	color: black;
}

#firstHeading, #siteSub {
	text-align: center;
	display: block;
}

#siteSub {
	margin-top: -0.5em;
	margin-bottom: 4em;
}

/* Article Body */

.mw-body-content {
	font-size: inherit;
	text-align: justify;
	-moz-hyphens: auto;
	-webkit-hyphens: auto;
	hyphens: auto;
	line-height: 1.5em;
}

.mw-body {
	padding: 2em 0;
}

.mw-body h1, .mw-body h2, .mw-body h3, .mw-body h4, .mw-body h5, .mw-body h6, div#content h1, div#content h2, div#content #firstHeading {
	font-family: inherit;
	line-height: 1.5em;
	margin-bottom: 0.5em;
}

.mw-body h1, div#content h1 {
	font-size: 2em;
}

.mw-body h2, div#content h2 {
	font-size: 1.5em;
}

.mw-body h3 {
	font-size: 1.2em;
}

.mw-body h4 {
	font-size: 1.1em;
}

.mw-body h5, .mw-body h6 {
	font-size: 1.0em;
}

.mw-body p {
	margin: 0;
}

.mw-body p + p {
	text-indent: 2em;
}

.mw-editsection {
	/* hide more non-content */
	display: none;
}

table.ambox {
	margin-bottom: 1em;
}

dl dd {
	/* center definitions (most useful for display equations) */
	text-align: center;
}

span.texhtml {
	/* revert inline math to default font */
	font-family: inherit;
	font-size: inherit;
	line-height: inherit;
}

/* Table of Contents */

#toc, .toc {
	border: none;
	padding: 0;
	background: none;
	font-size: inherit;
	/* span 100% of the width */
	display: block;
}

.mw-body #toc h2, .mw-body .toc h2 {
	font-family: inherit;
	font-size: 1.5em;
}

#toc h2, .toc h2 {
	display: block;
}

#toc #toctitle, .toc #toctitle, #toc .toctitle, .toc .toctitle {
	text-align: left;
}

.toctoggle {
	display: none;
}

/* Figures */

div.tright {
	margin: 0.5em 0 0.5em 1.5em;
}

div.tleft {
	margin: 0.5em 1.5em 0.5em 0;
}

/* Code */

.mw-code {
	margin: 1em 0;
}

pre, code {
	font-family: "Latin Modern Mono", monospace !important;
}

sup {
	text-indent: 0;
}
</style>
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="ue5--fondamentaux-du-développement-web-frontal-niveau-2">UE5 : Fondamentaux du développement web frontal, niveau 2</h1>
<h2 id="séance-4--penser-les-données-par-un-orm-implémentation-et-interactions">Séance 4 : Penser les données par un ORM: implémentation et interactions</h2>
<ol>
<li><a href="#lecture">Lecture des données</a>
<ol>
<li><a href="#simple">Des requêtes simples avec l'ORM</a>
<ol>
<li><a href="#all"><code>query.all()</code></a></li>
<li><a href="#first"><code>query.first()</code></a></li>
<li><a href="#limit"><code>query.limit()</code></a></li>
<li><a href="#get"><code>query.get()</code></a></li>
</ol>
</li>
<li><a href="#filtrer">Filtrer les données</a>
<ol>
<li><a href="#condition">Appliquer une condition sur les données</a></li>
<li><a href="#conditions">Appliquer plusieurs conditions sur les données</a>
<ol>
<li><a href="#and"><code>AND</code></a></li>
<li><a href="#or"><code>OR</code></a></li>
</ol>
</li>
</ol>
</li>
<li><a href="#agregation">Fonctions d'agrégation</a>
<ol>
<li><a href="#count"><code>query.count()</code></a></li>
<li><a href="#order"><code>query.order_by()</code></a></li>
<li><a href="#group"><code>query.group_by()</code></a></li>
<li><a href="#having"><code>query.having()</code></a></li>
</ol>
</li>
<li><a href="#jointures">Jointures</a>
<ol>
<li><a href="#classes">Utilisation des relations entre classes des modèles</a></li>
<li><a href="#join"><code>query.select_from()</code> et <code>query.join()</code></a></li>
<li><a href="#union"><code>query.union()</code></a></li>
</ol>
</li>
</ol>
</li>
<li><a href="#ecriture">Ecriture des données</a>
<ol>
<li><a href="#insert"><code>INSERT</code></a></li>
<li><a href="#update"><code>UPDATE</code></a></li>
<li><a href="#delete"><code>DELETE</code></a></li>
</ol>
</li>
<li><a href="#pagination">Pagination des données</a></li>
</ol>
<h3 id="lecture-des-données-">Lecture des données <a id="lecture"></a></h3>
<p><em>Code concerné</em>: <a href="https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/tree/master/Seance4/lecture">Seance4/lecture</a>: pour cette partie, une route Flask pour chaque cas se trouve l'application <code>lecture</code>. A la fin de chacune de ces routes, les données sont transformées pour être affichées dans le template, ce qui nous intéresse moins dans cette partie.</p>
<p>La lecture de la <a href="https://docs.sqlalchemy.org/en/14/orm/query.html">documentation SQLAlchemy de <code>query</code></a> est recommandée pour appréhender l'ensemble des membres de <code>query</code>.</p>
<h4 id="des-requêtes-simples-avec-lorm-">Des requêtes simples avec l'ORM <a id="simple"></a></h4>
<h5 id="queryall-"><code>query.all()</code> <a id="all"></a></h5>
<p>Afin de pouvoir requêter la base de données, il est nécessaire d'appeler la méthode <code>query</code> des classes des modèles de base de données. Pour ramener l'ensemble des données de la classe -- donc de la table relationnelle --, <code>query</code> possède le membre <code>all()</code>.</p>
<p><code>all()</code> renvoie une liste l'objets mappés par l'ORM qu'il faut imaginer ainsi: <code>[&lt;Objet 1&gt;, &lt;Objet 2&gt;]</code>. En itérant sur chacun des objets, les valeurs de l'objet sont accessibles par le nom du champ déclaré dans la classe du modèle.</p>
<p>Un exemple vaut mieux que la théorie:</p>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /all</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country

...
query =  Country.query
tous_resultats = query.<span class="hljs-built_in">all</span>()
...
</code></pre>
<p>Commentaires:</p>
<ul>
<li><code>Country</code> est la classe du modèle de base de données <code>models/factbook.py</code>; cette classe correspond donc à la table <code>country</code> dans la base de données</li>
<li>communément, puisque <code>query</code> possède de nombreux membres (nous le verrons au fur et à mesure de ce cours), une variable <code>query</code> ou <code>q</code> est déclarée en début de route; elle servira de réceptable aux opérations que l'on effectuera ensuite sur les données</li>
<li>pour avoir tous les résultats de la table, <code>all()</code> est appliqué</li>
<li>l'équivalent SQL de cette requête SQLAlchemy est<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> country
</code></pre>
</li>
</ul>
<p><em>NB</em>: <code>query</code> dédoublonne les objets, ce qui peut conduire à ce que <code>len(resultat_query)</code> soit inférieur à un <code>count()</code> effectué sur les mêmes données. Ce dédoublonnage est effectué sur la clé primaire.</p>
<h5 id="queryfirst--"><code>query.first()</code>  <a id="first"></a></h5>
<p>Comme son nom l'indique, <code>first()</code> renvoie uniquement le premier résultat sous la forme <code>&lt;Objet 1&gt;</code></p>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /first</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country

...
query =  Country.query
resultat = query.first()
...
</code></pre>
<p>Son équivalent SQL est le suivant:</p>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> country
LIMIT <span class="hljs-number">1</span>
</code></pre>
<h5 id="querylimit-"><code>query.limit()</code> <a id="limit"></a></h5>
<p>Comme son nom l'indique, <code>limit()</code> renvoie uniquement le premier nombre de résultats demandé sous la forme <code>[&lt;Objet 1&gt;,&lt;Objet 2&gt;, etc.]</code></p>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /limit</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country

...
query =  Country.query
resultat = query.limit(<span class="hljs-number">10</span>).<span class="hljs-built_in">all</span>()
...
</code></pre>
<p>Son équivalent SQL est le suivant:</p>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> country
LIMIT <span class="hljs-number">10</span>
</code></pre>
<h5 id="queryget--"><code>query.get()</code>  <a id="get"></a></h5>
<p><code>get(identifiant)</code> retourne un objet selon un identifiant donné en paramètre. Cet identifiant est une des valeurs du champ de clé primaire de la table relationnelle/classe du modèle.</p>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /get</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country

...
query =  Country.query
resultat = query.get(<span class="hljs-string">&quot;fr&quot;</span>)
...
</code></pre>
<p>Son équivalent SQL est le suivant:</p>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> country
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;fr&#x27;</span>
</code></pre>
<h4 id="filtrer-les-données-">Filtrer les données <a id="filtrer"></a></h4>
<h5 id="appliquer-une-condition-sur-les-données--">Appliquer une condition sur les données  <a id="condition"></a></h5>
<p><code>filter()</code> est un des membres de <code>query</code>. Il permet de filtrer les données de la table relationnelle. Afin d'avoir les potentiels résultats en retour, il est nécessaire d'appeler <code>all()</code>, <code>first()</code> ou <code>get()</code> à la suite. <code>filter()</code> prend autant de paramètres qu'il y a de conditions. Une condition s'exprime ainsi:</p>
<pre><code class="language-python">query.<span class="hljs-built_in">filter</span>(Classe_du_modele.champ operateur_de_comparaison Valeur)
</code></pre>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /filter</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country

...
query =  Country.query
resultat = query.<span class="hljs-built_in">filter</span>(Country.<span class="hljs-built_in">type</span> == <span class="hljs-string">&quot;sovereign&quot;</span>).<span class="hljs-built_in">all</span>()
...
</code></pre>
<p>Son équivalent SQL est le suivant:</p>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> country
<span class="hljs-keyword">WHERE</span> type <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;sovereign&#x27;</span>
</code></pre>
<h5 id="appliquer-plusieurs-conditions-sur-les-données--">Appliquer plusieurs conditions sur les données  <a id="conditions"></a></h5>
<p>Il existe plusieurs manières d'accumuler les filtres (un <code>AND</code> SQL), ou d'appliquer des opérateurs spécifiques tels que <code>OR</code>, <code>LIKE</code>, <code>NOT</code>.</p>
<h6 id="and--"><code>AND</code>  <a id="and"></a></h6>
<p>Comme évoque ci-dessus, <code>filter</code> accepte autant de paramètres que de conditions; ainsi, si plusieurs conditions sont séparées par une virgule, un <code>AND</code> implicite sera appliqué.</p>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /filter_and_implicite</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country

...
query =  Country.query
resultat = query.<span class="hljs-built_in">filter</span>(Country.<span class="hljs-built_in">type</span> == <span class="hljs-string">&quot;sovereign&quot;</span>, Country.<span class="hljs-built_in">id</span> == <span class="hljs-string">&#x27;fr&#x27;</span>).<span class="hljs-built_in">all</span>()
...
</code></pre>
<p>Son équivalent SQL est le suivant:</p>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> country
<span class="hljs-keyword">WHERE</span> type <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;sovereign&#x27;</span> <span class="hljs-keyword">AND</span> id <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;fr&#x27;</span>
</code></pre>
<p>Un opérateur SQLAlchemy existe également pour appliquer un <code>AND</code>. C'est en réalité c'est opérateur qui est appliqué lorsque les paramètres sont accumulés dans <code>filter</code>: il s'agit de <code>and_()</code>. Il est exprimé de la manière suivante:</p>
<pre><code class="language-python">query.<span class="hljs-built_in">filter</span>(and_(Classe_du_modele.champ operateur_de_comparaison Valeur, Classe_du_modele.champ operateur_de_comparaison Valeur))
</code></pre>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /filter_and_explicite</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> and_

...
query =  Country.query
resultat = query.<span class="hljs-built_in">filter</span>(and_(Country.<span class="hljs-built_in">type</span> == <span class="hljs-string">&quot;sovereign&quot;</span>, Country.<span class="hljs-built_in">id</span> == <span class="hljs-string">&#x27;fr&#x27;</span>)).<span class="hljs-built_in">all</span>()
...
</code></pre>
<h6 id="or--"><code>OR</code>  <a id="or"></a></h6>
<p>De même que pour <code>AND</code>, l'expression de <code>OR</code> peut se faire de deux manières.</p>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /filter_or_implicite</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country

...
query =  Country.query
resultats = query.<span class="hljs-built_in">filter</span>((Country.<span class="hljs-built_in">type</span> == <span class="hljs-string">&#x27;dependency&#x27;</span>)|(Country.<span class="hljs-built_in">id</span> == <span class="hljs-string">&#x27;fr&#x27;</span>)).<span class="hljs-built_in">all</span>()
...
</code></pre>
<p>Son équivalent SQL est le suivant:</p>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> country
<span class="hljs-keyword">WHERE</span> type <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;dependency&#x27;</span> <span class="hljs-keyword">OR</span> id <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;fr&#x27;</span>
</code></pre>
<p>L'autre méthode est l'utilisation du <code>or_()</code> de SQLAlchemy, qui prend autant de paramètres que de conditions.</p>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /filter_or_explicite</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> or_

...
query =  Country.query
resultat = query.<span class="hljs-built_in">filter</span>(or_(Country.<span class="hljs-built_in">type</span> == <span class="hljs-string">&quot;dependency&quot;</span>, Country.<span class="hljs-built_in">id</span> == <span class="hljs-string">&#x27;fr&#x27;</span>)).<span class="hljs-built_in">all</span>()
...
</code></pre>
<h4 id="fonctions-dagrégation-">Fonctions d'agrégation <a id="agregation"></a></h4>
<h5 id="querycount--"><code>query.count()</code>  <a id="count"></a></h5>
<p><code>count()</code> retourne un INTEGER. Il peut être appliqué directement après <code>query</code> ou bien après <code>filter</code> ou tout autre membre de <code>query</code>.</p>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /count</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country

...
query =  Country.query
resultat = query.<span class="hljs-built_in">filter</span>(Country.<span class="hljs-built_in">type</span> == <span class="hljs-string">&#x27;sovereign&#x27;</span>).count()
...
</code></pre>
<p>Son équivalent SQL est le suivant:</p>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)
<span class="hljs-keyword">FROM</span> country
</code></pre>
<h5 id="queryorder_by--"><code>query.order_by()</code>  <a id="order"></a></h5>
<p>Par défaut, <code>order_by()</code> trie par ordre ascendant, comme dans SQL.</p>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /order_by</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country

...
query =  Country.query
resultat = query.order_by(Country.name).<span class="hljs-built_in">all</span>()
...
</code></pre>
<p>Son équivalent SQL est le suivant:</p>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> country
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> name
</code></pre>
<p>Si l'on veut trier par ordre descendant, il convient d'appeler la méthode <code>.desc()</code> disponible pour chacun des champs de la classe du modèle de base de données.</p>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /order_by_desc</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country

...
query =  Country.query
resultat = query.order_by(Country.name.desc()).<span class="hljs-built_in">all</span>()
...
</code></pre>
<h5 id="querygroup_by--"><code>query.group_by()</code>  <a id="count"></a></h5>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /group_by</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country

...
query =  Country.query
resultat = query.group_by(Country.<span class="hljs-built_in">type</span>).<span class="hljs-built_in">all</span>()
...
</code></pre>
<p>Son équivalent SQL est le suivant:</p>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> type
<span class="hljs-keyword">FROM</span> country
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> type
</code></pre>
<p>La requête effectuée ci-dessus revient en réalité à effectuer un</p>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> type
<span class="hljs-keyword">FROM</span> country
</code></pre>
<p>Avec SQLAlchemy, il est possible de faire un <code>query.distinct()</code>; afin d'indiquer le(s) champ(s) sur le(s)quel(s) effectuer le distinct, il est nécessaire d'utiliser <code>with_entities(Classe.champ)</code> en amont. Ce <code>with_entities</code> permet d'expliciter les champs que l'on souhaite voir retournés dans notre liste de résultats.</p>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /distinct</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country

...
query =  Country.query
resultat = query.with_entities(Country.<span class="hljs-built_in">type</span>).distinct()
...
</code></pre>
<h5 id="queryhaving--"><code>query.having()</code>  <a id="having"></a></h5>
<p>Imaginons que nous souhaitions afficher tous les types de pays qui ont plus de 20 pays rentrés dans la table Country. En SQL, nous effectuerions la requête suivante:</p>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> type, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)
<span class="hljs-keyword">FROM</span> country
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> type
<span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">&gt;</span> <span class="hljs-number">20</span>
</code></pre>
<p>Avec SQLAlchemy, la logique est la même:</p>
<ul>
<li>appliquer un <code>group_by</code></li>
<li>puis un <code>having</code></li>
</ul>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /having</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> func

...
query =  Country.query
resultat = query.group_by(Country.<span class="hljs-built_in">type</span>).having(func.count(Country.name) &gt; <span class="hljs-number">20</span>).<span class="hljs-built_in">all</span>()
...
</code></pre>
<p><code>sqlalchemy.func</code> fournit de très nombreuses fonctions avancées pour effectuer des requêtes:</p>
<ul>
<li><code>max</code></li>
<li><code>min</code></li>
<li><code>sum</code></li>
<li><code>count</code></li>
<li>etc.</li>
</ul>
<h4 id="jointures-">Jointures <a id="jointures"></a></h4>
<h5 id="utilisation-des-relations-entre-classes-des-modèles--">Utilisation des relations entre classes des modèles  <a id="classes"></a></h5>
<p>Cette méthode est à privilègier dès lors que les jointures sont simples puisqu'elles sont incluses dans la déclaration des classes du modèle de base de données.</p>
<p>Lors de la création des classes dans <code>models/factbook.py</code>, nous avons créé des champs qui ne sont pas physiquement dans les tables grâce à <code>db.relationship()</code>. Pour la classe <code>Country()</code>, c'est notamment le cas de <code>resources</code>.
Dès lors qu'une relation est indiquée dans une classe, l'objet sur lequel pointe la relation est accessible depuis notre objet requêté. Prenons l'exemple des ressources des pays:</p>
<ul>
<li>
<pre><code class="language-python">  <span class="hljs-comment"># models/factbook.py Country()</span>

  ...
  resources = db.relationship(
      <span class="hljs-string">&#x27;Resources&#x27;</span>, 
      secondary=country_resources, 
      backref=<span class="hljs-string">&quot;resources&quot;</span>
  )
  ...
</code></pre>
Ici, <code>resources</code> renvoie vers la table <code>country_resources</code>, qui a été décalrée en tout début de modèle.</li>
<li>Cette table <code>country_resources</code> a elle-même une relation, grâce à une clé étrangère, vers la classe <code>Resources</code>:<pre><code class="language-python"><span class="hljs-comment"># models/factbook.py Country()</span>

...
db.Column(<span class="hljs-string">&#x27;resource&#x27;</span>, db.String(<span class="hljs-number">100</span>), db.ForeignKey(<span class="hljs-string">&#x27;resources.id&#x27;</span>), primary_key=<span class="hljs-literal">True</span>)
...
</code></pre>
</li>
</ul>
<p>Les objets de la <code>Resources</code> liés aux objets <code>Country</code> via la table <code>country_resources</code> sont alors accessibles depuis les objets <code>Country</code> sans avoir à le spécifier dans la requête SQLAlchemy.</p>
<p>En SQL, nous écririons la requête suivante:</p>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> country a
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> country_resources b <span class="hljs-keyword">on</span> b.id <span class="hljs-operator">=</span> a.id
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> resources c <span class="hljs-keyword">on</span> c.id <span class="hljs-operator">=</span> b.resource
</code></pre>
<p>Avec SQLAlchemy, il suffit de la requête suivante:</p>
<pre><code class="language-python">Country.query.<span class="hljs-built_in">all</span>()
</code></pre>
<p>Tout s'effectue ensuite dans la manière d'appeler les attributs de classes; par exemple, pour obtenir le nom de la ressource, il faut écrire : <code>country.resources.name</code> (où country est un des objets de la liste de résultats).</p>
<p>Créons une route qui affiche les ressources d'un pays donné en paramètre:</p>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /ressources</span>

...
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/ressources/&lt;string:nom&gt;&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">ressources</span>(<span class="hljs-params">nom</span>):
    ressources = []

    query =  Country.query
    ressources = query.<span class="hljs-built_in">filter</span>(Country.name == nom).first()

    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;pages/pays.html&quot;</span>, pays=nom, ressources=ressources, sous_titre=nom)
</code></pre>
<p>Puisqu'un seul pays est indiqué en paramètre et passé en filtre, il est suffisant de faire un <code>first()</code> dans la requête.</p>
<p>Dans le template, on peut alors boucler sur les ressources du pays:</p>
<pre><code class="language-html"><span class="hljs-comment">&lt;!-- templates/pages/pays.html --&gt;</span>

...
{%if ressources %}
    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
        {%for resource in ressources.resources %}
            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>{{resource.name}}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        {%endfor%}
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
{%else%}
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Il n&#x27;y a pas de ressources connues pour ce pays<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
{%endif%}
...
</code></pre>
<h5 id="queryselect_from-et-queryjoin--"><code>query.select_from()</code> et <code>query.join()</code>  <a id="join"></a></h5>
<p>Pour contrôler plus finement les jointures entre classes et le résultat obtenu, il est possible d'utiliser conjointement <code>select_from()</code> et <code>join()</code>.</p>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /altitude</span>

...
donnees =  db.session.\
        query(Elevation).\
        select_from(Country).\
        join(Country.elevations).\
        <span class="hljs-built_in">filter</span>(Country.name == nom).\
        <span class="hljs-built_in">all</span>()
...
</code></pre>
<p>Commentaires:</p>
<ul>
<li><code>db.session</code> permet d'ouvrir directement une session avec la base de données. Cette étape était normalment effectuée par SQLAlchemy quand <code>Country.query</code> était appelé.</li>
<li><code>query(Elevation)</code> indique les données qui sont renvoyées dans le résultat, mais aussi la classe avec laquelle la jointure s'effectuera</li>
<li><code>select_from(Country)</code> indique le <code>FROM</code> SQL</li>
<li><code>join(Country.elevations)</code> indique le champ de classe qui sert de clé pour faire la jointure avec <code>Elevation</code>. Ici, nous indiquons la propriété de relation <code>elevations</code></li>
<li><code>filter()</code> est un filtre sur les données comme vu précédemment</li>
<li>le résultat obtenu n'est pas une liste d'objets <code>Country</code>, mais une liste d'objets <code>ELevation</code>, comme demandé dans le <code>query(Elevation)</code></li>
</ul>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> b.<span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> country a
<span class="hljs-keyword">JOIN</span> elevation b <span class="hljs-keyword">on</span> b.id <span class="hljs-operator">=</span> a.id
<span class="hljs-keyword">WHERE</span> a.name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;France&#x27;</span>
</code></pre>
<h5 id="queryunion--"><code>query.union()</code>  <a id="union"></a></h5>
<p>Il peut arriver que l'on ai besoin d'assembler plusieurs résultats de requête (avec chacun un schéma de sortie identifique bien entendu). C'est le rôle du <code>union</code>, comme en SQL.</p>
<p>Prenons un exemple: une route reçoit en paramètres deux pays de manière à afficher les ressources de chacun de ces pays.</p>
<p>Une première solution serait d'effectuer un simple <code>filter(or_())</code>.</p>
<pre><code class="language-python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/ressources_simple/&lt;string:nom&gt;/&lt;string:nom_&gt;&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">ressources_simple</span>(<span class="hljs-params">nom, nom_</span>):
    ressources = []

    ressources =  Country.query.<span class="hljs-built_in">filter</span>(or_(Country.name == nom, Country.name == nom_)).<span class="hljs-built_in">all</span>()

    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;pages/ressources.html&quot;</span>, pays=nom, ressources=ressources, sous_titre=nom_)
</code></pre>
<p>En SQL, l'équivalent serait la requête suivante:</p>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> country a 
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> country_resources b <span class="hljs-keyword">on</span> b.id <span class="hljs-operator">=</span> a.id
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> resources c <span class="hljs-keyword">on</span> c.id <span class="hljs-operator">=</span> b.resource 
<span class="hljs-keyword">WHERE</span> a.name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;France&#x27;</span> <span class="hljs-keyword">or</span> a.name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Germany&#x27;</span>
</code></pre>
<p>Mais pour étudier <code>union</code>, nous pourrions très bien agréger deux requêtes SQLAlchemy pour créer le résultat attendu.</p>
<pre><code class="language-python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/ressources_union/&lt;string:nom&gt;/&lt;string:nom_&gt;&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">ressources_union</span>(<span class="hljs-params">nom, nom_</span>):
    ressources = []

    query =  Country.query
    ressources_nom = query.<span class="hljs-built_in">filter</span>(Country.name == nom)
    ressources_nom_ = query.<span class="hljs-built_in">filter</span>(Country.name == nom_)

    ressources = ressources_nom.union(ressources_nom_).<span class="hljs-built_in">all</span>()

    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;pages/ressources.html&quot;</span>, pays=nom, ressources=ressources, sous_titre=nom_)
</code></pre>
<p>Pour <code>union()</code>, la requête SQL serait :</p>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
        <span class="hljs-keyword">FROM</span> country a 
        <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> country_resources b <span class="hljs-keyword">on</span> b.id <span class="hljs-operator">=</span> a.id
        <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> resources c <span class="hljs-keyword">on</span> c.id <span class="hljs-operator">=</span> b.resource 
        <span class="hljs-keyword">WHERE</span> a.name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;France&#x27;</span>
    <span class="hljs-keyword">UNION</span> 
        <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
        <span class="hljs-keyword">FROM</span> country a 
        <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> country_resources b <span class="hljs-keyword">on</span> b.id <span class="hljs-operator">=</span> a.id
        <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> resources c <span class="hljs-keyword">on</span> c.id <span class="hljs-operator">=</span> b.resource 
        <span class="hljs-keyword">WHERE</span> a.name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Germany&#x27;</span>
    )
</code></pre>
<h3 id="ecriture-des-données-">Ecriture des données <a id="ecriture"></a></h3>
<p>Avant d'aborder ces trois opérations sur les données, il est nécessaire de réviser ce qu'est une transaction SQL:</p>
<ul>
<li>l'utilisateur lance une transcation (SELECT, UPDATE, INSERT, DELETE, etc.)</li>
<li>en fonction du statut de la transaction une fois terminée, deux choix se posent alors:
<ul>
<li>si tout s'est bien passé:
<ul>
<li>soit l'utilisateur commite les modifications</li>
<li>soit il les annule (la base de données retrouve alors l'état qu'elle avait juste avant la transaction)</li>
</ul>
</li>
<li>si une erreur est survenue, la transaction est annulée, et la base de données retrouve l'état qu'elle avait juste avant la transaction</li>
</ul>
</li>
</ul>
<p><img src="./img/transaction.jpg" alt="h:100px"></p>
<p>Avec SQLAlchemy, les étapes sont identiques:</p>
<ul>
<li>l'objet est identifié</li>
<li>il est ensuite ajouté à la session</li>
<li>la transaction est lancée</li>
<li>en fonction du statut de la réponse, il faut soit commiter soit annuler les modifications</li>
</ul>
<h4 id="insert-"><code>INSERT</code> <a id="insert"></a></h4>
<p>L'insertion de données est l'opération la plus simple puisqu'elle ne nécessite pas d'identifier au préalable l'objet existant sur lequel effectuer la modification. Il suffit alors de créer un nouvel objet, puis de l'insérer.</p>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /add_country</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country
<span class="hljs-keyword">from</span> ..app <span class="hljs-keyword">import</span> db

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/add_country/&lt;string:pays&gt;/&lt;string:id&gt;/&lt;string:type&gt;&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add_country</span>(<span class="hljs-params">pays, <span class="hljs-built_in">id</span>, <span class="hljs-built_in">type</span></span>):
    nouveau_pays = Country(<span class="hljs-built_in">id</span>=<span class="hljs-built_in">id</span> , name=pays , <span class="hljs-built_in">type</span>=<span class="hljs-built_in">type</span>)
    db.session.add(nouveau_pays)
    db.session.commit()
</code></pre>
<p>Commentaires:</p>
<ul>
<li><code>nouveau_pays</code> est une nouvelle instance de la classe <code>Country</code>; les attributs de cette classe (les champs de la table) sont remplis avec les valeurs adéquates</li>
<li>une fois l'objet crée, il est inséré en base avec <code>add(object)</code></li>
<li>il reste ensuite à commiter la modification avec <code>commit()</code></li>
</ul>
<p>Voici l'équivalent SQL généré:</p>
<pre><code class="language-sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> country(id, Introduction,name, type)
<span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;pr&#x27;</span>, <span class="hljs-keyword">null</span> , <span class="hljs-string">&#x27;Paris&#x27;</span> ,<span class="hljs-string">&#x27;dependency&#x27;</span>);

<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<p>Créons une route <code>/add_ressources/&lt;string:pays&gt;/&lt;string:ressource&gt;</code> qui puisse ajouter une ressource à un pays.</p>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /add_ressource</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span> Country
<span class="hljs-keyword">from</span> ..app <span class="hljs-keyword">import</span> db

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/add_ressource/&lt;string:pays&gt;/&lt;string:ressource&gt;&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add_ressource</span>(<span class="hljs-params">pays, ressource</span>):
    
    pays = Country.\
        query.\
        <span class="hljs-built_in">filter</span>(Country.name == pays).\
        first()
    ressource = Resources.\
        query.\
        <span class="hljs-built_in">filter</span>(Resources.name == ressource).\
        first()

    pays.resources.append(ressource)
    db.session.add(pays)
    db.session.commit()
</code></pre>
<p>Commentaires:</p>
<ul>
<li>il faut commencer par récupérer les objets correspondant aux paramètres <code>pays</code> et <code>ressource</code></li>
<li>on ajoute l'objet <code>ressource</code> aux ressources de l'objet <code>pays</code> via la relation entre la classe <code>Country</code> et la classe <code>Resources</code></li>
<li>on ajoute la relation pays-ressource en base puis on commite</li>
</ul>
<p><em>Code concerné</em>: <a href="https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/tree/master/Seance4/insertion">Seance4/insertion</a></p>
<p><em>NB</em> : pour la gestion des erreurs et les <code>rollback()</code>, voir le prochain cours sur la gestion des erreurs</p>
<h4 id="update-"><code>UPDATE</code> <a id="update"></a></h4>
<p>Afin d'effectuer une mise à jour sur une ligne d'une table de la base de données, il faut au préalable récupérer l'objet que l'on souhaite modifier.</p>
<p>Si l'on souhaite par exemple modifier le <code>name</code> de la ressource PET, il faut:</p>
<ul>
<li>récupérer l'objet correspondant à PET</li>
<li>le modifier en indiquant la nouvelle valeur de <code>name</code> grâce à <code>update(dictionnaire_champ_valeur)</code></li>
</ul>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py /update_ressource</span>

<span class="hljs-keyword">from</span> ..models.factbook <span class="hljs-keyword">import</span>  Resources

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/update_ressource/&lt;string:current_name&gt;/&lt;string:new_name&gt;&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">update_ressource</span>(<span class="hljs-params">current_name, new_name</span>):
    
    Resources.query.<span class="hljs-built_in">filter</span>(Resources.name == current_name).update({<span class="hljs-string">&quot;name&quot;</span>: new_name})
    db.session.commit()
</code></pre>
<p><code>update</code> étant un des membres de <code>query</code>, il est possible de l'appliquer directement après avoir sélectionner le bon objet. Il ne faut pas oublier d'effectuer le commit à la fin de l&quot;instruction.</p>
<p>L'équivalent SQL de cette route serait:</p>
<pre><code class="language-sql"><span class="hljs-keyword">UPDATE</span> resources 
<span class="hljs-keyword">SET</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;pétrole&#x27;</span>
<span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;petroleum&#x27;</span>;

<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<p><em>Code concerné</em>: <a href="https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/tree/master/Seance4/update">Seance4/update</a></p>
<h4 id="delete-"><code>DELETE</code> <a id="delete"></a></h4>
<p>Pour supprimer un objet, il y a deux possibilités. Dans les deux cas, l'objet doit être préalablement séléctionné, et les modifications committées.</p>
<p>La première méthode est équivalente à celle de l'INSERT, c'est à dire que l'objet est sélectionné par une requête, puis on appelle <code>db.session.delete(objet)</code>.</p>
<pre><code class="language-python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/delete_ressource/&lt;string:name&gt;&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_ressource</span>(<span class="hljs-params">name</span>):

    ressource = Resources.\
        query.\
        <span class="hljs-built_in">filter</span>(Resources.name == name).\
        first()

    db.session.delete(ressource)
    db.session.commit()
</code></pre>
<p>Le seconde méthode est comme celle de l'UPDATE et utilise le membre <code>delete</code> de <code>query</code>.</p>
<pre><code class="language-python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/delete_ressource_by_query/&lt;string:name&gt;&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_ressource_by_query</span>(<span class="hljs-params">name</span>):
    
    Resources.query.<span class="hljs-built_in">filter</span>(Resources.name == name).delete()
    db.session.commit()
</code></pre>
<p>Dans les deux cas, l'équivalent SQL serait:</p>
<pre><code class="language-sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> resources 
<span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;petroleum&#x27;</span>;

<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<p><em>Code concerné</em>: <a href="https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/tree/master/Seance4/delete">Seance4/delete</a></p>
<h3 id="pagination-des-résultats-">Pagination des résultats <a id="pagination"></a></h3>
<p>Jusqu'à présent, nous affichons tous les résultats de nos requêtes sur une seule page, comme <a href="localhost:5000/all">/all</a>. Qu'il y ait 5 ou 300 résultats, tous sont sur cette page. Il convient donc désormais d'effectuer une pagination sur nos résultats afin d'avoir des pages homogènes et lisibles. Une pagination contient:</p>
<ul>
<li>un numéro de page</li>
<li>un nombre de résultats par page souhaité</li>
</ul>
<p>Cette fonctionnelité est présente dans SQL avec <code>LIMIT</code>  et <code>OFFSET</code>, ce que nous pourrions développer dans une route <code>/pagination_sql</code>:</p>
<pre><code class="language-python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/pagination_sql/&lt;int:numero_page&gt;/&lt;int:nb_resultats&gt;&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">pagination_sql</span>(<span class="hljs-params">numero_page, nb_resultats</span>):
    donnees = []

    query =  Country.query
    tous_resultats = query.limit(nb_resultats * numero_page).offset(numero_page).<span class="hljs-built_in">all</span>()
</code></pre>
<p>En SQL, la requête serait la suivante:</p>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> country
LIMIT <span class="hljs-number">20</span>
<span class="hljs-keyword">OFFSET</span> <span class="hljs-number">2</span>
</code></pre>
<p>Cette manière de faire, plutôt artisanale, n'est pas sans problèmes:</p>
<ul>
<li>que se passe-t-il quand il n'y a plus de résultats?</li>
<li>comment savoir si la page précédente ou la suivante est disponible?</li>
<li>combien y a-t-il de pages au total?</li>
</ul>
<p>C'est pourquoi Flask-SQLAlchemy propose une méthode <code>paginate()</code> qui remplace <code>all()</code> et prend 3 paramètres en entrée:</p>
<ul>
<li><code>page</code>: numéro de la pgae, commençant par 1</li>
<li><code>per_page</code>, nombre de résultats par page</li>
<li><code>error_out</code>: si <code>True</code>, une erreur 404 sera retournée si plus aucun résultat n'est trouvé</li>
</ul>
<p>Le retour de cette méthode un <a href="https://flask-sqlalchemy.palletsprojects.com/en/2.x/api/#flask_sqlalchemy.Pagination">objet Pagination</a> qui comporte les méthodes suivantes, toutes très utiles:</p>
<table>
<thead>
<tr>
<th>Méthode</th>
<th>Description</th>
<th>Retour</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>has_next</code></td>
<td>Indique la présence ou non d'une page suivante</td>
<td><code>True</code> si une page suivante existe</td>
</tr>
<tr>
<td><code>has_prev</code></td>
<td>Indique la présence ou non d'une page précédente</td>
<td><code>True</code> si une page précédente existe</td>
</tr>
<tr>
<td><code>items</code></td>
<td>Fournit les items correspondant à la requête et à la pagination demandées</td>
<td>Liste des items de la page demandée</td>
</tr>
<tr>
<td><code>iter_pages</code></td>
<td>Itère sur les numéros de pages de la pagination (4 paramètres permettent de gérer le numéro des pages à afficher; voir la documentation)</td>
<td>Liste de numéros de pages</td>
</tr>
<tr>
<td><code>next</code></td>
<td></td>
<td>Objet Pagination correspondant à la page suivante</td>
</tr>
<tr>
<td><code>next_num</code></td>
<td>Numéro de la page suivante</td>
<td>Integer</td>
</tr>
<tr>
<td><code>page</code></td>
<td>Numéro de la page actuelle</td>
<td>Integer</td>
</tr>
<tr>
<td><code>pages</code></td>
<td>Nombre total de pages</td>
<td>Integer</td>
</tr>
<tr>
<td><code>prev</code></td>
<td></td>
<td>Objet Pagination correspondant à la page précédente</td>
</tr>
<tr>
<td><code>prev_num</code></td>
<td>Numéro de la page précédente</td>
<td>Integer</td>
</tr>
<tr>
<td><code>total</code></td>
<td>Nombre d'items correspondant à la requête</td>
<td>Integer</td>
</tr>
</tbody>
</table>
<p>Le nombre de résultats par page peut provenir de deux sources différentes:</p>
<ul>
<li>l'utilisateur peut choisir le nombre qu'il souhaite sur les pages, auquel cas le <code>per_page</code> provient de l'URL via un paramètre</li>
<li><code>per_page</code> peut être une variable globale de l'application; alors cette variable est déclarée dans les variables d'environnement et lue dans la classe <code>Config()</code>; c'est ce choix que nous allons faire</li>
</ul>
<pre><code class="language-bash"><span class="hljs-comment"># .env</span>

...
PAYS_PER_PAGE=10
</code></pre>
<pre><code class="language-python"><span class="hljs-comment"># config.py Config()</span>

...
    PAYS_PER_PAGE = os.environ.get(<span class="hljs-string">&quot;PAYS_PER_PAGE&quot;</span>)
</code></pre>
<p>Il est ensuite temps de modifier la route en ne renvoyant pas un ensemble de résultats au template via <code>all()</code>, mais en renvoyant uniquement l'objet Pagination résultant de <code>paginate()</code>.</p>
<pre><code class="language-python"><span class="hljs-comment"># routes/generales.py </span>

...
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/pays/&lt;int:page&gt;&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">pays</span>(<span class="hljs-params">page</span>):
    donnees = []

    query =  Country.query
    tous_resultats = query.paginate(page=page, per_page=app.config[<span class="hljs-string">&quot;PAYS_PER_PAGE&quot;</span>])
</code></pre>
<p>Une fois l'objet Pagination (<code>tous_resultats</code> dans notre cas) transmis au template, tout se fait dans ce dernier.</p>
<pre><code class="language-html"><span class="hljs-comment">&lt;!-- templates/pages/pays.html--&gt;</span>

{%if pagination%}
    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;table&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>#<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>Nom<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>Type<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>Description<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
            {%for pays in pagination.items%}
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span>{{loop.index}}<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{pays.name}}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{pays.type}}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{pays.Introduction}}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
            {%endfor%}
        <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
{%endif%}
</code></pre>
<p>Commentaires:</p>
<ul>
<li>au lieu d'itérer sur les résultats de <code>all()</code>, l'itération se fait ici sur l'objet Pagination <code>.items</code></li>
<li>chaque item est en réalité un objet <code>Country</code> dans notre cas, comme ce que l'on trouvait auparavant dans la liste de résultats <code>all</code></li>
</ul>
<p>Afin d'afficher une barre de navigation entre les pages, <code>paginate</code> nous aide à nouveau.</p>
<pre><code class="language-html"><span class="hljs-comment">&lt;!-- templates/macros.html pagination_macro --&gt;</span>
<span class="hljs-comment">&lt;!-- une macro est ici utilisée pour éviter la répétition de code; il est cependant tout à fait possible d&#x27;utiliser le code à l&#x27;intérieur et de le mettre directement dans le template templates/pages/pays.html --&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">&quot;research-pagination&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pagination&quot;</span>&gt;</span>
            {%- for page in pagination.iter_pages() %}
                {% if page %}
        
                {% if page != pagination.page %}
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;page-item&quot;</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;page-link&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{{ url_for(&quot;</span><span class="hljs-attr">pays</span>&quot;, <span class="hljs-attr">page</span>=<span class="hljs-string">page+1)</span> }}&quot;&gt;</span>{{page}}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                {% else %}
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;page-item active disabled&quot;</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;page-link&quot;</span>&gt;</span>{{page}} <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sr-only&quot;</span>&gt;</span>(actuelle)<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                {% endif %}
        
                {% else %}
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;page-item disabled&quot;</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;page-link&quot;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                {% endif %}
        
            {%- endfor %}
        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>Désormais, la navigation entre les pages de résultats est très facile:</p>
<ul>
<li>pour l'utilisateur</li>
<li>mais aussi pour le développeur, <code>paginate</code> a réduit au minimum le code nécessaire pour créer des barres de navigation</li>
</ul>
<p><img src="img/pagination.jpg" alt="h:200px"></p>
<p><em>Code concerné</em>: <a href="https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/tree/master/Seance4/pagination">Seance4/pagination</a></p>

        
        <script async type="text/javascript">
/* From extension marp-team.marp-vscode */
(()=>{var F=Object.defineProperty;var d=(E,k)=>F(E,"name",{value:k,configurable:!0});(()=>{var E={676:(b,f,h)=>{b.exports=h(185)},185:(b,f)=>{"use strict";var h;h={value:!0};const S={h1:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"1"},style:"display: block; font-size: 2em; margin-block-start: 0.67em; margin-block-end: 0.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h2:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"2"},style:"display: block; font-size: 1.5em; margin-block-start: 0.83em; margin-block-end: 0.83em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h3:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"3"},style:"display: block; font-size: 1.17em; margin-block-start: 1em; margin-block-end: 1em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h4:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"4"},style:"display: block; margin-block-start: 1.33em; margin-block-end: 1.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h5:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"5"},style:"display: block; font-size: 0.83em; margin-block-start: 1.67em; margin-block-end: 1.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h6:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"6"},style:"display: block; font-size: 0.67em; margin-block-start: 2.33em; margin-block-end: 2.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},span:{proto:()=>HTMLSpanElement},pre:{proto:()=>HTMLElement,style:"display: block; font-family: monospace; white-space: pre; margin: 1em 0; --marp-auto-scaling-white-space: pre;"}},M="data-marp-auto-scaling-wrapper",p="data-marp-auto-scaling-svg",l="data-marp-auto-scaling-container";class o extends HTMLElement{constructor(){super(),this.svgPreserveAspectRatio="xMinYMid meet";const s=d(r=>([n])=>{const{width:e,height:t}=n.contentRect;this[r]={width:e,height:t},this.updateSVGRect()},"e");this.attachShadow({mode:"open"}),this.containerObserver=new ResizeObserver(s("containerSize")),this.wrapperObserver=new ResizeObserver((...r)=>{s("wrapperSize")(...r),this.flushSvgDisplay()})}static get observedAttributes(){return["data-downscale-only"]}connectedCallback(){var s,r,n,e,t;this.shadowRoot.innerHTML=`
<style>
  svg[${p}] { display: block; width: 100%; height: auto; vertical-align: top; }
  span[${l}] { display: table; white-space: var(--marp-auto-scaling-white-space, nowrap); width: max-content; }
</style>
<div ${M}>
  <svg part="svg" ${p}>
    <foreignObject><span ${l}><slot></slot></span></foreignObject>
  </svg>
</div>
    `.split(/\n\s*/).join(""),this.wrapper=(s=this.shadowRoot.querySelector(`div[${M}]`))!==null&&s!==void 0?s:void 0;const i=this.svg;this.svg=(n=(r=this.wrapper)===null||r===void 0?void 0:r.querySelector(`svg[${p}]`))!==null&&n!==void 0?n:void 0,this.svg!==i&&(this.svgComputedStyle=this.svg?window.getComputedStyle(this.svg):void 0),this.container=(t=(e=this.svg)===null||e===void 0?void 0:e.querySelector(`span[${l}]`))!==null&&t!==void 0?t:void 0,this.observe()}disconnectedCallback(){this.svg=void 0,this.svgComputedStyle=void 0,this.wrapper=void 0,this.container=void 0,this.observe()}attributeChangedCallback(){this.observe()}flushSvgDisplay(){const{svg:s}=this;s&&(s.style.display="inline",requestAnimationFrame(()=>{s.style.display=""}))}observe(){this.containerObserver.disconnect(),this.wrapperObserver.disconnect(),this.wrapper&&this.wrapperObserver.observe(this.wrapper),this.container&&this.containerObserver.observe(this.container),this.svgComputedStyle&&this.observeSVGStyle(this.svgComputedStyle)}observeSVGStyle(s){const r=d(()=>{const n=(()=>{const e=s.getPropertyValue("--preserve-aspect-ratio");return e?e.trim():`x${(({textAlign:t,direction:i})=>{if(t.endsWith("left"))return"Min";if(t.endsWith("right"))return"Max";if(t==="start"||t==="end"){let a=i==="rtl";return t==="end"&&(a=!a),a?"Max":"Min"}return"Mid"})(s)}YMid meet`})();n!==this.svgPreserveAspectRatio&&(this.svgPreserveAspectRatio=n,this.updateSVGRect()),s===this.svgComputedStyle&&requestAnimationFrame(r)},"t");r()}updateSVGRect(){var s,r,n,e,t,i,a;let m=Math.ceil((r=(s=this.containerSize)===null||s===void 0?void 0:s.width)!==null&&r!==void 0?r:0);const v=Math.ceil((e=(n=this.containerSize)===null||n===void 0?void 0:n.height)!==null&&e!==void 0?e:0);this.dataset.downscaleOnly!==void 0&&(m=Math.max(m,(i=(t=this.wrapperSize)===null||t===void 0?void 0:t.width)!==null&&i!==void 0?i:0));const y=(a=this.svg)===null||a===void 0?void 0:a.querySelector(":scope > foreignObject");if(y?.setAttribute("width",`${m}`),y?.setAttribute("height",`${v}`),this.svg&&(this.svg.setAttribute("viewBox",`0 0 ${m} ${v}`),this.svg.setAttribute("preserveAspectRatio",this.svgPreserveAspectRatio),this.svg.style.height=m<=0||v<=0?"0":""),this.container){const _=this.svgPreserveAspectRatio.toLowerCase();this.container.style.marginLeft=_.startsWith("xmid")||_.startsWith("xmax")?"auto":"0",this.container.style.marginRight=_.startsWith("xmi")?"auto":"0"}}}d(o,"s");const u=d((c,{attrs:s={},style:r})=>class extends c{constructor(...n){super(...n);for(const[e,t]of Object.entries(s))this.hasAttribute(e)||this.setAttribute(e,t);this.attachShadow({mode:"open"})}static get observedAttributes(){return["data-auto-scaling"]}connectedCallback(){this._update()}attributeChangedCallback(){this._update()}_update(){const n=r?`<style>:host { ${r} }</style>`:"";let e="<slot></slot>";const{autoScaling:t}=this.dataset;t!==void 0&&(e=`<marp-auto-scaling exportparts="svg:auto-scaling" ${t==="downscale-only"?"data-downscale-only":""}>${e}</marp-auto-scaling>`),this.shadowRoot.innerHTML=n+e}},"r");let g;const q=Symbol(),V="marpitSVGPolyfill:setZoomFactor,",z=Symbol();let A,C;function N(c){const s=typeof c=="object"&&c.target||document,r=typeof c=="object"?c.zoom:c;window[z]||(Object.defineProperty(window,z,{configurable:!0,value:!0}),window.addEventListener("message",({data:e,origin:t})=>{if(t===window.origin)try{if(e&&typeof e=="string"&&e.startsWith(V)){const[,i]=e.split(","),a=Number.parseFloat(i);Number.isNaN(a)||(C=a)}}catch(i){console.error(i)}}));let n=!1;Array.from(s.querySelectorAll("svg[data-marpit-svg]"),e=>{var t,i,a,m;e.style.transform||(e.style.transform="translateZ(0)");const v=r||C||e.currentScale||1;A!==v&&(A=v,n=v);const y=e.getBoundingClientRect(),{length:_}=e.children;for(let L=0;L<_;L+=1){const x=e.children[L];if(x.getScreenCTM){const w=x.getScreenCTM();if(w){const W=(i=(t=x.x)===null||t===void 0?void 0:t.baseVal.value)!==null&&i!==void 0?i:0,B=(m=(a=x.y)===null||a===void 0?void 0:a.baseVal.value)!==null&&m!==void 0?m:0,G=x.children.length;for(let T=0;T<G;T+=1){const P=x.children[T];if(P.tagName==="SECTION"){const{style:O}=P;O.transformOrigin||(O.transformOrigin=`${-W}px ${-B}px`),O.transform=`scale(${v}) matrix(${w.a}, ${w.b}, ${w.c}, ${w.d}, ${w.e-y.left}, ${w.f-y.top}) translateZ(0.0001px)`;break}}}}}}),n!==!1&&Array.from(s.querySelectorAll("iframe"),({contentWindow:e})=>{e?.postMessage(`${V}${n}`,window.origin==="null"?"*":window.origin)})}d(N,"h");function j({once:c=!1,target:s=document}={}){const r=navigator.vendor==="Apple Computer, Inc."?[N]:[];let n=!c;const e=d(()=>{for(const t of r)t({target:s});n&&window.requestAnimationFrame(e)},"s");return e(),()=>{n=!1}}d(j,"g"),A=1,C=void 0;const $=Symbol(),H=d((c=document)=>{if(typeof window>"u")throw new Error("Marp Core's browser script is valid only in browser context.");if(((e=document)=>{const t=window[q];t||customElements.define("marp-auto-scaling",o);for(const i of Object.keys(S)){const a=`marp-${i}`,m=S[i].proto();g!=null||(g=!!document.createElement("div",{is:"marp-auto-scaling"}).outerHTML.startsWith("<div is")),g&&m!==HTMLElement?t||customElements.define(a,u(m,{style:S[i].style}),{extends:i}):(t||customElements.define(a,u(HTMLElement,S[i])),e.querySelectorAll(`${i}[is="${a}"]`).forEach(v=>{v.outerHTML=v.outerHTML.replace(new RegExp(`^<${i}`,"i"),`<${a}`).replace(new RegExp(`</${i}>$`,"i"),`</${a}>`)}))}window[q]=!0})(c),c[$])return c[$];const s=j({target:c}),r=d(()=>{s(),delete c[$]},"n"),n=Object.assign(r,{cleanup:r,update:()=>H(c)});return Object.defineProperty(c,$,{configurable:!0,value:n}),n},"v");f.browser=H,h=H,h=j}},k={};function R(b){var f=k[b];if(f!==void 0)return f.exports;var h=k[b]={exports:{}};return E[b](h,h.exports,R),h.exports}d(R,"__webpack_require__");var Z={};(()=>{"use strict";var b=R(676);function f(){let p,l;const o=d(()=>{const u=document.getElementById("__marp-vscode"),g=!!u;p!==g?(document.body.classList.toggle("marp-vscode",g),g?l=(0,b.browser)():(l?.cleanup(),l=void 0),p=g):g&&l?.update(),p?(u&&h(u),S()):M()},"updateCallback");window.addEventListener("load",()=>window.setTimeout(o,100)),window.addEventListener("vscode.markdown.updateContent",o),o()}d(f,"preview");const h=d(p=>{p.querySelectorAll("[is]").forEach(l=>{if(l.nodeName.includes("-")||document.createElement(l.nodeName).constructor!==l.constructor)return;const{outerHTML:u}=l;l.outerHTML=u,console.debug("[marp-vscode] Custom element has been upgraded forcibly:",u.slice(0,u.indexOf(">")+1||void 0))})},"forceUpgradeCustomElements"),S=d(()=>{const p=document.querySelectorAll("style:not(#__marp-vscode-style):not(#_defaultStyles):not([data-marp-vscode-body])"),l=document.querySelectorAll('link[rel="stylesheet"][href]:not([href*="marp-vscode"])');p.forEach(o=>{o.closest("#__marp-vscode")||(o.dataset.marpVscodeBody=o.textContent??"",o.textContent="")}),l.forEach(o=>{if(o.closest("#__marp-vscode"))return;const{href:u}=o;o.dataset.marpVscodeHref=u,o.removeAttribute("href")})},"removeStyles"),M=d(()=>{const p=document.querySelectorAll("style[data-marp-vscode-body]"),l=document.querySelectorAll("link[data-marp-vscode-href]");p.forEach(o=>{o.textContent=o.dataset.marpVscodeBody||"",delete o.dataset.marpVscodeBody}),l.forEach(o=>{o.href=o.dataset.marpVscodeHref||"",delete o.dataset.marpVscodeHref})},"restoreStyles");f()})()})();})();

</script>

    </body>
    </html>