<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>UE5 &colon; Fondamentaux du d&eacute;veloppement web frontal&comma; niveau 2</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

/* From extension marp-team.marp-vscode */
#__marp-vscode {
  all: initial;
}

/* Override VS Code default CSS rules reverting to initial
   https://github.com/microsoft/vscode/blob/master/src/vs/workbench/contrib/webview/browser/pre/main.js#L53 */
body.marp-vscode {
  padding: 0;
}

body.marp-vscode img {
  max-width: unset;
  max-height: unset;
}

body.marp-vscode a,
body.marp-vscode a:hover,
body.marp-vscode code {
  color: unset;
}

body.marp-vscode blockquote {
  background: unset;
  border-color: unset;
}

@media screen {
  body.marp-vscode {
    overflow-y: scroll;
  }

  #__marp-vscode [data-marp-vscode-slide-wrapper] {
    margin: 20px;
  }

  #__marp-vscode svg[data-marpit-svg] {
    box-shadow: 0 5px 10px rgb(0 0 0 / 25%);
    display: block;
    margin: 0;
  }

  /* Based on https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
  #code-csp-warning {
    background-color: #444;
    box-shadow: 1px 1px 1px rgb(0 0 0 / 25%);
    color: white;
    cursor: pointer;
    font-family: sans-serif;
    font-size: 12px;
    line-height: 22px;
    margin: 16px;
    padding: 6px;
    position: fixed;
    right: 0;
    text-align: center;
    top: 0;
    word-wrap: break-word;
  }

  #code-csp-warning:hover {
    text-decoration: none;
    background-color: #007acc;
    box-shadow: 2px 2px 2px rgb(0 0 0 / 25%);
  }
}

@media print {
  body.marp-vscode #code-csp-warning {
    display: none;
  }
}

/* From extension ms-toolsai.jupyter */
/* These classnames are inherited from bootstrap, but are present in most notebook renderers */

.alert {
    width: auto;
    padding: 1em;
    margin-top: 1em;
    margin-bottom: 1em;
}
.alert > *:last-child {
    margin-bottom: 0;
}
#preview > .alert:last-child {
    /* Prevent this being set to zero by the default notebook stylesheet */
    padding-bottom: 1em;
}

.alert-success {
    /* Note there is no suitable color available, so we just copy "info" */
    background-color: var(--theme-info-background);
    color: var(--theme-info-foreground);
}
.alert-info {
    background-color: var(--theme-info-background);
    color: var(--theme-info-foreground);
}
.alert-warning {
    background-color: var(--theme-warning-background);
    color: var(--theme-warning-foreground);
}
.alert-danger {
    background-color: var(--theme-error-background);
    color: var(--theme-error-foreground);
}

</style>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
        <style>
/*********************************************************************
This is free and unencumbered software released into the public domain.

Anyone is free to copy, modify, publish, use, compile, sell, or
distribute this software, either in source code form or as a compiled
binary, for any purpose, commercial or non-commercial, and by any
means.

For more information, please refer to <http://unlicense.org/>
*********************************************************************/

/*
WiTeX
https://github.com/AndrewBelt/WiTeX
*/


/* Latin Modern (LaTeX default) font */

@font-face {
	font-family: 'Latin Modern Roman';
	font-weight: normal;
	font-style: normal;
	src: url('https://cdn.rawgit.com/AndrewBelt/WiTeX/master/fonts/lmroman10-regular.woff') format('woff');
}

@font-face {
	font-family: 'Latin Modern Roman';
	font-weight: bold;
	font-style: normal;
	src: url('https://cdn.rawgit.com/AndrewBelt/WiTeX/master/fonts/lmroman10-bold.woff') format('woff');
}

@font-face {
	font-family: 'Latin Modern Roman';
	font-weight: normal;
	font-style: italic;
	src: url('https://cdn.rawgit.com/AndrewBelt/WiTeX/master/fonts/lmroman10-italic.woff') format('woff');
}

@font-face {
	font-family: 'Latin Modern Roman';
	font-weight: bold;
	font-style: italic;
	src: url('https://cdn.rawgit.com/AndrewBelt/WiTeX/master/fonts/lmroman10-bolditalic.woff') format('woff');
}

@font-face {
	font-family: 'Latin Modern Mono';
	font-weight: normal;
	font-style: normal;
	src: url('https://cdn.rawgit.com/AndrewBelt/WiTeX/master/fonts/lmmono10-regular.woff') format('woff');
}

@font-face {
	font-family: 'Latin Modern Mono';
	font-weight: normal;
	font-style: italic;
	src: url('https://cdn.rawgit.com/AndrewBelt/WiTeX/master/fonts/lmmono10-italic.woff') format('woff');
}

/* Page Layout */

body {
	background: none;
	font-size: 14pt;
	font-family: 'Latin Modern Roman', serif;
	color: black;
}

h1, h2, h3, h4, h5, h6 {
	border: none;
	font-weight: bold;
}

a, a:visited {
	color: #a00;
}

a.new, a.new:visited {
	color: black;
}

ul {
	list-style: disc;
}

#mw-navigation, #mw-page-base, #mw-head-base, #footer {
	/* nuke everything but the content */
	display: none;
}

/* Content Box */

.mw-body {
	max-width: 720px;
	margin: 1em auto;
}

#content, div#content {
	border: none;
	color: black;
}

#firstHeading, #siteSub {
	text-align: center;
	display: block;
}

#siteSub {
	margin-top: -0.5em;
	margin-bottom: 4em;
}

/* Article Body */

.mw-body-content {
	font-size: inherit;
	text-align: justify;
	-moz-hyphens: auto;
	-webkit-hyphens: auto;
	hyphens: auto;
	line-height: 1.5em;
}

.mw-body {
	padding: 2em 0;
}

.mw-body h1, .mw-body h2, .mw-body h3, .mw-body h4, .mw-body h5, .mw-body h6, div#content h1, div#content h2, div#content #firstHeading {
	font-family: inherit;
	line-height: 1.5em;
	margin-bottom: 0.5em;
}

.mw-body h1, div#content h1 {
	font-size: 2em;
}

.mw-body h2, div#content h2 {
	font-size: 1.5em;
}

.mw-body h3 {
	font-size: 1.2em;
}

.mw-body h4 {
	font-size: 1.1em;
}

.mw-body h5, .mw-body h6 {
	font-size: 1.0em;
}

.mw-body p {
	margin: 0;
}

.mw-body p + p {
	text-indent: 2em;
}

.mw-editsection {
	/* hide more non-content */
	display: none;
}

table.ambox {
	margin-bottom: 1em;
}

dl dd {
	/* center definitions (most useful for display equations) */
	text-align: center;
}

span.texhtml {
	/* revert inline math to default font */
	font-family: inherit;
	font-size: inherit;
	line-height: inherit;
}

/* Table of Contents */

#toc, .toc {
	border: none;
	padding: 0;
	background: none;
	font-size: inherit;
	/* span 100% of the width */
	display: block;
}

.mw-body #toc h2, .mw-body .toc h2 {
	font-family: inherit;
	font-size: 1.5em;
}

#toc h2, .toc h2 {
	display: block;
}

#toc #toctitle, .toc #toctitle, #toc .toctitle, .toc .toctitle {
	text-align: left;
}

.toctoggle {
	display: none;
}

/* Figures */

div.tright {
	margin: 0.5em 0 0.5em 1.5em;
}

div.tleft {
	margin: 0.5em 1.5em 0.5em 0;
}

/* Code */

.mw-code {
	margin: 1em 0;
}

pre, code {
	font-family: "Latin Modern Mono", monospace !important;
}

sup {
	text-indent: 0;
}
</style>
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="ue5--fondamentaux-du-développement-web-frontal-niveau-2">UE5 : Fondamentaux du développement web frontal, niveau 2</h1>
<h2 id="séance-2--routes-et-templates">Séance 2 : Routes et templates</h2>
<ol>
<li><a href="#intro">Introduction aux templates</a></li>
<li><a href="#utilisation">Utilisation des templates</a></li>
<li><a href="#jinja">Jinja2 </a>
<ol>
<li><a href="#appels">Appels de paramètres et filtres</a></li>
<li><a href="#controle">Structures de contrôle</a>
<ol>
<li><a href="#if">La boucle <em>if</em></a></li>
<li><a href="#for">La boucle <em>for</em></a></li>
</ol>
</li>
<li><a href="#dico">Dictionnaires</a></li>
<li><a href="#heritages">Héritages</a>
<ol>
<li><a href="#extends">Les <em>extends</em></a></li>
<li><a href="#includes">Les <em>include</em></a></li>
</ol>
</li>
</ol>
</li>
<li><a href="#liens">Liens internes</a></li>
<li><a href="#statiques">Les statiques: CSS et JS</a></li>
</ol>
<h3 id="introduction-aux-templates-">Introduction aux templates <a id="intro"></a></h3>
<p>Plutôt que de renvoyer une chaîne de caractères brute aux routes Flask, il est possible de renvoyer du HTML. Prenons l'exemple d'une barre de navigation sur une page Web, le retour de la fonction serait le suivant pour la route <code>/home</code>:</p>
<pre><code class="language-python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/home&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">home</span>():
   <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;&#x27;
      &lt;html&gt;
         &lt;body&gt;
            &lt;nav&gt;
               &lt;ol&gt;
                  &lt;li&gt;Lien1&lt;/li&gt;
                  &lt;li&gt;Lien2&lt;/li&gt;
               &lt;/ol&gt;
            &lt;/nav&gt;
         &lt;/body&gt;
      &lt;/html&gt;
   &#x27;&#x27;&#x27;</span>
</code></pre>
<p>Une barre de navigation est normalement partagée entre toutes les pages du site. La route <code>/page</code> suivante renverrait donc cette barre également:</p>
<pre><code class="language-python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/page&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">page</span>():
   <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;&#x27;
      &lt;html&gt;
         &lt;body&gt;
            &lt;nav&gt;
               &lt;ol&gt;
                  &lt;li&gt;Lien1&lt;/li&gt;
                  &lt;li&gt;Lien2&lt;/li&gt;
               &lt;/ol&gt;
            &lt;/nav&gt;
         &lt;/body&gt;
      &lt;/html&gt;
   &#x27;&#x27;&#x27;</span>
</code></pre>
<p>Si maintenant on veut ajouter un lien dans cette barre de navigation, il faut l'ajouter dans chacune des pages du site! Pas très pratique et efficient... De plus, le code HTML d'une page peut être incroyablement long, surtout quand on génrérera plus tard le HTML à la volée en fonction des données: pas question donc de le mettre directement dans le return de la fonction.</p>
<h3 id="utilisation-des-templates-">Utilisation des templates <a id="utilisation"></a></h3>
<p>La plupart des frameworks offrent un système de templates. Un template est dans notre cas un fichier HTML qui sera rempli par les données qu'on lui fournira quand nous l'appelerons en sortie de fonction.</p>
<p>Les templates sont rangés dans le dossier <code>templates/</code> pour plusieurs raisons:</p>
<ul>
<li>il faut séparer l'application de sa représentation graphique: <code>templates/</code> devient donc un module de notre application</li>
<li>écarter les templates peut permettre à un Web designer d'être recruté et de ne travailler que sur ce dossier, sans qu'il n'ait de connaissances sur le fonctionnement applicatif</li>
<li>l'intérieur du module peut lui-même être ordonné selon une logique propre à chacun</li>
</ul>
<p><em>Note</em>: si le dossier des templates s'appele autrement que <code>templates/</code>, il est possible d'indiquer le nom de notre module lors de l'initialisation de Flask.</p>
<pre><code class="language-python"><span class="hljs-comment">#app.py</span>
...
app = Flask(
   __name__,
   template_folder=<span class="hljs-string">&#x27;nom_du_module&#x27;</span>
   )
...
</code></pre>
<p><em>Note 2</em>: A partir de maintenant, nous allons développer une petite application autour des données du World Factbook de la CIA. Une base SQLITE comprenant les données est disponible au lien suivant: <a href="https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/blob/e96e6bdb031c4a20e25aeeb45bbc6f21953b8df9/factbook.sqlite">https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/blob/master/factbook.sqlite</a>. Bootstrap sera utilisé pour mettre en page le site.</p>
<p>Commençons par construire une page d'accueil, c'est à dire une route et un template.</p>
<pre><code class="language-python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template

...

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">accueil</span>():
    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;pages/accueil.html&quot;</span>)
</code></pre>
<p><code>render_template()</code> est la fonction qui va parser les templates que nous créons, et va y rajouter, au besoin, les données que l'on souhaitera (ce que nous verrons plus loin). Cette fonction accepte en premier argument le chemin relatif vers le template depuis le module <code>templates/</code>, et dans les arguments suivants les variables que l'on souhaite transmettre au template.</p>
<pre><code class="language-html"><span class="hljs-comment">&lt;!-- templates/accueil.html --&gt;</span>
<span class="hljs-meta">&lt;!doctype <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Factbook<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">integrity</span>=<span class="hljs-string">&quot;sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi&quot;</span> <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">&quot;anonymous&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Bienvenue sur l&#x27;application du Factbook!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;</span> <span class="hljs-attr">integrity</span>=<span class="hljs-string">&quot;sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3&quot;</span> <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">&quot;anonymous&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><em>Note 3</em>: Naturellement, nous venons de mettre la route dans <code>app.py</code>. Maintenant que nous débutons le développement d'une application, il est temps d'utiliser au maximum les modules Python. Dans la <a href="../Seance1/Seance1_app.html">Séance1</a>, nous avons abordé la structure de l'application, et notamment le dossier <code>routes/</code>. C'est ce dossier qui va contenir nos routes, et non plus le fichier d'initialisation <code>app.py</code>. Pour cela; il est nécessaire de créer le module <code>routes</code> avec un script Python <code>generales.py</code> qui accueillera nos premières routes:</p>
<pre><code class="language-tree">app
| app.py
| templates/
| routes/
|  |-- __init__.py
|  |-- generales.py
</code></pre>
<p>Il va falloir ensuite indiquer dans <code>app.py</code> où se trouvent nos routes. Pour cela, il faut ajouter à la toute fin du fichier (à la fin du fichier est important puisque <code>generales.py</code> contient un appel à <code>app</code>, il faut donc que <code>app</code> soit initialisé pour que <code>generales.py</code> puisse fonctionner sans erreurs) :</p>
<pre><code class="language-python"><span class="hljs-comment">#app.py</span>
...
<span class="hljs-keyword">from</span> .routes <span class="hljs-keyword">import</span> generales
</code></pre>
<p>De même, dans <code>generales.py</code>, il faut indiquer que l'on importe <code>app</code> depuis <code>app.py</code> (avec un chemin relatif bien entendu!).</p>
<pre><code class="language-python"><span class="hljs-comment"># generale.py</span>
<span class="hljs-keyword">from</span> ..app <span class="hljs-keyword">import</span> app
...
</code></pre>
<p><em>Exemple concerné</em>: <a href="https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/tree/master/Seance2/premiers_templates">Seance2/premiers_templates</a></p>
<p>L'utilisation des templates n'est pas plus compliqué! Seulement, nous avons encore des pages uniquement statiques, nos fonctions Python ne font que renvoyer vers un template HTML qui ne bouge pas pour le moment.</p>
<h3 id="jinja2-">Jinja2 <a id="jinja"></a></h3>
<p>Le système de templates de Flask s'appelle Jinja2: il n'est pas spécifique à Flask et est aussi utilisé dans d'autres frameworks.</p>
<h4 id="appels-de-paramètres-et-filtres-">Appels de paramètres et filtres <a id="appels"></a></h4>
<p>Le World Factbook contient des données sur tous les pays. Imaginons que nous souhaitions récupérer les données d'un pays spécifique, nous pourrions simplement l'indiquer dans les paramètres de l'URL. Développons une route Flask qui affiche dans le titre de la page le pays sélectionné.</p>
<pre><code class="language-python"><span class="hljs-comment"># la route</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/pays/&lt;string:nom&gt;&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">pays</span>(<span class="hljs-params">nom</span>):
    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;pages/pays.html&quot;</span>, pays=nom)
</code></pre>
<p>Comme vu dans <a href="./Seance2_routes.md#une-route-get-avec-param%C3%A8tres">la partie sur les routes avec des paramètres</a>, le paramètre <code>nom</code> de la route est appelé dans la fonction <code>pays()</code>. C'est la valeur de ce paramètre qui est transmise à Jinja via <code>render_template()</code>:</p>
<ul>
<li><code>pays</code> est le nom de la variable que l'on retrouvera dans Jinja et que l'on appelera dans le template</li>
<li>la valeur de <code>pays</code> est une string (comme défini dans le paramètre de la route, car aucun traitement n'a été effectué dans la fonction <code>pays()</code> sur cette donnée)</li>
</ul>
<pre><code class="language-html"><span class="hljs-comment">&lt;!-- dans le body du template--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Bienvenue sur l&#x27;application du Factbook!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Voici le lien vers le site officiel : <span class="hljs-tag">&lt;<span class="hljs-name">a</span>
                <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://www.cia.gov/the-world-factbook/&quot;</span>&gt;</span>https://www.cia.gov/the-world-factbook/<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Vous avez choisi d&#x27;afficher les données du pays suivant: {{pays}}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>Commentaires:</p>
<ul>
<li>dans Jinja, les variables sont appelées dans les blocks <code>{{...}}</code></li>
<li><code>{{pays}}</code> appele le paramètre <code>pays</code> retourné dans la fonction <code>render_template()</code></li>
<li>on peut faire appel à des blocks Jinja n'importe où dans le template HTML: dans <code>&lt;head&gt;&lt;/head&gt;</code>, <code>&lt;body&gt;&lt;/body&gt;</code>, etc.</li>
</ul>
<p><em>Exemple concerné</em>: <a href="https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/tree/master/Seance2/variables_jinja">Seance2/variables_jinja</a></p>
<p>Un autre point fort de Jinja est qu'il permet de faire des opérations simples sur les paramètres qu'il reçoit: ces opérations sont nommées 'filtres'. Différents <a href="https://jinja.palletsprojects.com/en/3.0.x/templates/#builtin-filters">filtres existent</a>, les plus courants et utiles étant les suivants:</p>
<ul>
<li><code>length()</code></li>
<li><code>sum()</code></li>
<li><code>upper()</code>  et <code>lower()</code></li>
</ul>
<p>Il s'utilisent comme suit: <code>{{paramètre|length}}</code></p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Bienvenue sur l&#x27;application du Factbook!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Voici le lien vers le site officiel : <span class="hljs-tag">&lt;<span class="hljs-name">a</span>
                <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://www.cia.gov/the-world-factbook/&quot;</span>&gt;</span>https://www.cia.gov/the-world-factbook/<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Vous avez choisi d&#x27;afficher les données du pays suivant: {{pays}}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Longueur de la chaîne de caractères du pays choisi: {{pays|length}} caractères<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p><em>Exemple concerné</em>: <a href="https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/tree/master/Seance2/filtres_jinja">Seance2/filtres_jinja</a></p>
<h4 id="structures-de-contrôle-">Structures de contrôle <a id="controle"></a></h4>
<h5 id="la-boucle-if-">La boucle <em>if</em> <a id="if"></a></h5>
<p>Jinja n'accepte pas seulement des blocs de variables (les <code>{{...}}</code>): les structures de contrôle sont permises avec des blocs <code>{%...%}...{%end...%}</code>. Voyons d'abord un bloc avec une condition <em>if</em>: la syntaxe est identique à celle de Python et n'est pas trop déroutante, il ne faut juste pas oublier de l'entourer par la syntaxe Jinja.</p>
<p>Les blocs <em>if</em> s'écrivent de la manière suivante:</p>
<pre><code class="language-html">{%if condition %}
   <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Du HTML correspondant à la condition réussie<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
{%else%}
   <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Du HTML correspondant à la condition non réussie<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
{%endif%}
</code></pre>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Bienvenue sur l&#x27;application du Factbook!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Voici le lien vers le site officiel : <span class="hljs-tag">&lt;<span class="hljs-name">a</span>
                <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://www.cia.gov/the-world-factbook/&quot;</span>&gt;</span>https://www.cia.gov/the-world-factbook/<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Vous avez choisi d&#x27;afficher les données du pays suivant: {{pays}}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Longueur de la chaîne de caractères du pays choisi: {{pays|length}} caractères<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        {%if pays|length &gt; 10%}
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>C&#x27;est un long nom de pays<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        {%else%}
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>C&#x27;est un nom de pays plutôt court<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        {%endif%}
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>Testons les deux URLs suivantes pour s'assurer du bon fonctionnement de notre structure de contrôle:</p>
<ul>
<li><a href="http://localhost:5000/pays/France">http://localhost:5000/pays/France</a></li>
<li><a href="http://localhost:5000/pays/R%C3%A9publique-Tch%C3%A8que">http://localhost:5000/pays/République-Tchèque</a></li>
</ul>
<p><em>Exemple concerné</em>: <a href="https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/tree/master/Seance2/if_jinja">Seance2/if_jinja</a></p>
<h5 id="la-boucle-for-">La boucle <em>for</em> <a id="for"></a></h5>
<p>Voyons maintenant une autre structure de contrôle: le <em>for</em>. Avant de l'utiliser, il va falloir renvoyer non pas une string à Jinja, mais une liste (le for s'exécutant généralement sur une liste). Renvoyer une liste ne pose pas de problème avec Flask et <code>render_template()</code>. En effet, les paramètres de <code>render_template()</code> acceptent n'importe quel type de donnée (string, integer, list, tuple, etc.).</p>
<pre><code class="language-python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/pays/&lt;string:nom&gt;&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">pays</span>(<span class="hljs-params">nom</span>):
   grandes_villes = []
   <span class="hljs-keyword">if</span> nom ==<span class="hljs-string">&#x27;France&#x27;</span>:
      grandes_villes = [<span class="hljs-string">&#x27;Paris&#x27;</span>, <span class="hljs-string">&#x27;Lyon&#x27;</span>, <span class="hljs-string">&#x27;Marseille&#x27;</span>]
   <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;pages/pays.html&quot;</span>, pays=nom, grandes_villes=grandes_villes)
</code></pre>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Grandes villes de {{pays}}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        {%if grandes_villes %}
        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
            {%for ville in grandes_villes %}
            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>{{ville}}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
            {%endfor%}
        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
        {%else%}
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Il n&#x27;y a pas de grande ville connue pour ce pays<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        {%endif%}
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>Commentaires:</p>
<ul>
<li>avant de boucler avec un <em>for</em>, il est conseillé de s'assurer avec un <em>if</em> de la présence d'une liste dans notre paramètres, et de son remplissage par au moins une valeur; c'est pourquoi il y a <code>{%if grandes_villes %}</code> au début</li>
<li>la structure du <em>for</em> avec Jinja s'écrit ainsi: <code>{% for element in liste %} ... {% endfor %}</code></li>
<li>il est possible d'écrire du HTML au sein des boucles: c'est l'exemple de <code>&lt;li&gt;{{ville}}&lt;/li&gt;</code></li>
<li>il est commun d'utiliser la boucle <em>for</em> avec les listes HTML: c'est ainsi que l'on peut générer du HTML à la volée, en fonction des données retournées par la fonction de la route</li>
</ul>
<p><em>Exemple concerné</em>: <a href="https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/tree/master/Seance2/for_jinja">Seance2/for_jinja</a></p>
<h4 id="dictionnaires-">Dictionnaires <a id="dico"></a></h4>
<p>La transmission de données, remontées d'une base de données par exemple, se fait généralement via JSON dans une application Web. Ainsi, un seul paramètre de <code>render_template()</code> prendra l'ensemble du JSON remonté depuis la source de données. Jinja va ensuite pouvoir parser ce paramètre et afficher ce qu'on lui demande.</p>
<p>Tentons de créer une route <code>pays/</code> (sans paramètre cette fois-ci) qui affichera, pour tous les pays stockés dans notre source de données,  une table HTML avec les champs suivants:</p>
<ul>
<li>nom du pays</li>
<li>capitale</li>
<li>continent</li>
</ul>
<p>Pour cela, réfléchissons aux besoins:</p>
<ul>
<li>afficher des champs spécifiques pour chaque pays: la représentation d'un pays va se faire via un objet JSON</li>
<li>construire une table HTML avec tous les pays: cela implique d'avoir une liste afin d'ajouter des lignes de table à la volée, selon le nombre de pays renvoyé par la source de données. Cette liste sera composée de toutes les représentations JSON des pays</li>
</ul>
<p>Il faut débuter par la création de la route et des données (nous verrons dans d'autres séances comment récupérer des données dans une base; en attendant, nous créons la liste d'objets <code>donnees</code> à la main):</p>
<pre><code class="language-python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/pays&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">pays</span>():
    donnees = [{
        <span class="hljs-string">&quot;nom&quot;</span>:<span class="hljs-string">&quot;France&quot;</span>,
        <span class="hljs-string">&quot;capitale&quot;</span>:<span class="hljs-string">&quot;Paris&quot;</span>,
        <span class="hljs-string">&quot;continent&quot;</span>:<span class="hljs-string">&quot;Europe&quot;</span>
    },{
        <span class="hljs-string">&quot;nom&quot;</span>:<span class="hljs-string">&quot;Etats-Unis&quot;</span>,
        <span class="hljs-string">&quot;capitale&quot;</span>:<span class="hljs-string">&quot;Washington&quot;</span>,
        <span class="hljs-string">&quot;continent&quot;</span>:<span class="hljs-string">&quot;Amérique&quot;</span>
    },{
        <span class="hljs-string">&quot;nom&quot;</span>:<span class="hljs-string">&quot;Egypte&quot;</span>,
        <span class="hljs-string">&quot;capitale&quot;</span>:<span class="hljs-string">&quot;Le Caire&quot;</span>,
        <span class="hljs-string">&quot;continent&quot;</span>:<span class="hljs-string">&quot;Afrique&quot;</span>
    },{
        <span class="hljs-string">&quot;nom&quot;</span>:<span class="hljs-string">&quot;Chine&quot;</span>,
        <span class="hljs-string">&quot;capitale&quot;</span>:<span class="hljs-string">&quot;Pékin&quot;</span>,
        <span class="hljs-string">&quot;continent&quot;</span>:<span class="hljs-string">&quot;Asie&quot;</span>
    }]
    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;pages/pays.html&quot;</span>, donnees=donnees)
</code></pre>
<pre><code class="language-html">{%if donnees%}
        <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;table&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>#<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>Nom<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>Capitale<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>Continent<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
                {%for pays in donnees%}
                <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span>{{loop.index}}<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{pays.nom}}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{pays.capitale}}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{pays.continent}}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
                {%endfor%}
            <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
{%endif%}
</code></pre>
<p>Commentaires:</p>
<ul>
<li><code>{{loop.index}}</code> permet d'afficher l'index de notre boucle courante</li>
<li>dans le <em>for</em>, <code>pays</code> renvoie par exemple<pre><code class="language-json"> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">&quot;nom&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;Etats-Unis&quot;</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;capitale&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;Washington&quot;</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;continent&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;Amérique&quot;</span>
 <span class="hljs-punctuation">}</span>
</code></pre>
</li>
<li>pour accéder aux champs d'un objet, c'est un simple parcours JSON: <code>nom_objet.champ</code></li>
<li>la boucle <em>for</em> n'est pas nécessaire dans tous les cas: si l'on veut afficher seulement le premier pays des données, il faut appeler <code>donnees[0]</code>; pour avoir son nom, il faut écrire <code>donnees[0][&quot;nom&quot;]</code></li>
</ul>
<p><em>Exemple concerné</em>: <a href="https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/tree/master/Seance2/dico_jinja">Seance2/dico_jinja</a></p>
<h3 id="héritages-">Héritages <a id="heritages"></a></h3>
<p>Comme vu au début de l'UE dans le cours HTML/CSS/JS, une page Web est composée de plusieurs parties, parmi lesquelles:</p>
<ul>
<li>header</li>
<li>menu et navbar</li>
<li>body</li>
<li>footer</li>
</ul>
<p>Trois de ces parties sont répétées entre toutes les pages du site Web (header, menu et navbar, et footer). Comme il est impensable de devoir changer toutes les pages HTML de notre site dès qu'il y a un changement fait sur l'une de ces trois parties, il convient de conteneuriser chacune des parties, et de les lier ensuite entre elles grâce à Jinja. On se retrouvera alors avec un seul template HTML pour le menu; il sera appelé ensuite par toutes les pages: c'est ce que l'on appele l'héritage de templates.</p>
<p><img src="https://raw.githubusercontent.com/MaximeChallon/Cours_Python_M2TNAH/03ee2c3da1d9800292cff74a2a8c30723809a9ac/images/incrustation.site.png" alt=""></p>
<h4 id="les-extends-">Les <em>extends</em> <a id="extends"></a></h4>
<p>Dans le template qui sert de conteneur, on va déclarer un (ou plusieurs) bloc qui sera complété par le(s) template(s) qui étend(ront) ce conteneur.</p>
<pre><code class="language-html"><span class="hljs-comment">&lt;!-- partials/conteneur.html --&gt;</span>
<span class="hljs-meta">&lt;!doctype <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Factbook | {{sous_titre}}<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    {% block body%}{%endblock%}
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>Dans le conteneur, on déclare ici:</p>
<ul>
<li>une variable <code>sous_titre</code>: toutes les fonctions de route pourront donc renvoyer un paramètre avec un sous-titre</li>
<li>un bloc <code>body</code> avec la syntaxe <code>{% block nom_du_block %}...{%endblock%}</code></li>
</ul>
<pre><code class="language-html"><span class="hljs-comment">&lt;!-- pages/pays.html --&gt;</span>
{% extends &quot;partials/conteneur.html&quot; %}

{% block body %}

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Bienvenue sur l&#x27;application du Factbook!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Voici le lien vers le site officiel : <span class="hljs-tag">&lt;<span class="hljs-name">a</span>
                <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://www.cia.gov/the-world-factbook/&quot;</span>&gt;</span>https://www.cia.gov/the-world-factbook/<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      
      ...

    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

{% endblock %}
</code></pre>
<p>Dans ce template, on rempli le bloc <code>body</code> avec du html et l'on n'a plus à se soucier des autres parties de la page comme le menu ou le header. La syntaxe est la suivante:</p>
<ul>
<li>on indique clairement au début du template quel conteneur on étend avec <code>{% extends &quot;chemin/relatif/vers/conteneur&quot; %}</code></li>
<li>on rempli les blocs définis dans le conteneur avec <code>{% block nom_bloc %}...{% endblock %}</code></li>
</ul>
<p>Avec Jinja, on peut emboîter des conteneurs à l'infini grâce à ce jeu de blocs étendus.</p>
<p><em>Exemple concerné</em>: <a href="https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/tree/master/Seance2/extends_jinja">Seance2/extends_jinja</a></p>
<h4 id="les-include-">Les <em>include</em> <a id="includes"></a></h4>
<p>En plus d'étendre un template, Flask donne la possibilité d'inclure un template. On peut alors insérer des sous-éléments dans des conteneurs ou des pages.</p>
<p><img src="https://raw.githubusercontent.com/MaximeChallon/Cours_Python_M2TNAH/03ee2c3da1d9800292cff74a2a8c30723809a9ac//images/incrustation.avancee.png" alt=""></p>
<p>L'inclusion, et l'extension,  sont  très pratiques. Prenons l'exemple du <code>&lt;head&gt;...&lt;/head&gt;</code> d'un fichier HTML (ici <code>partials/conteneur.html</code>):</p>
<pre><code class="language-html"><span class="hljs-comment">&lt;!-- partials/conteneur.html --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>{%block titre %}{%endblock%} | {{sous_titre}}<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    {% include &quot;partials/css.html&quot; %}
    {% include &quot;partials/metadata.html&quot; %}
    {% include &quot;partials/js.html&quot; %}
    {% block js %}{%endblock%}
    {% block css %}{%endblock%}
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
</code></pre>
<p>On permet ici plusieurs choses:</p>
<ul>
<li>l'inclusion de balises CSS et JS préformatées dans d'autres templates: ce sont les <code>{% include &quot;partials/css.html&quot; %}</code></li>
<li>l'inclusion de bloc HTML metadata avec <code>{% include &quot;partials/metadata.html&quot; %}</code></li>
<li>la définition de blocs acceptant l'extension: <code>{% block js %}{%endblock%}</code>. Ces blocs sont utiles si au cours d'une page spécifique il y a du CSS ou du JS à rajouter. Cela peut alors se faire en remplissant ces blocs dans les templates concernés.</li>
</ul>
<p><em>Exemple concerné</em>: <a href="https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/tree/master/Seance2/include_jinja">Seance2/include_jinja</a></p>
<h3 id="liens-internes-">Liens internes <a id="liens"></a></h3>
<p>La navigation de l'utilisateur au sein d'un site Web est primordiale: cliquer sur des liens est constant afin de se diriger vers les bonnes pages de notre site (nous évoquerons ici seulement les liens internes). Créons/réutilisons la route <code>/pays</code> d'affichage de tous les pays disponibles, et la route <code>/pays/&lt;string:nom&gt;</code> spécifique à un pays.</p>
<pre><code class="language-python"><span class="hljs-comment"># generales.py</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/pays&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">pays</span>():
    donnees = [{
        <span class="hljs-string">&quot;nom&quot;</span>:<span class="hljs-string">&quot;France&quot;</span>,
        <span class="hljs-string">&quot;capitale&quot;</span>:<span class="hljs-string">&quot;Paris&quot;</span>,
        <span class="hljs-string">&quot;continent&quot;</span>:<span class="hljs-string">&quot;Europe&quot;</span>
    },{
        <span class="hljs-string">&quot;nom&quot;</span>:<span class="hljs-string">&quot;Etats-Unis&quot;</span>,
        <span class="hljs-string">&quot;capitale&quot;</span>:<span class="hljs-string">&quot;Washington&quot;</span>,
        <span class="hljs-string">&quot;continent&quot;</span>:<span class="hljs-string">&quot;Amérique&quot;</span>
    },{
        <span class="hljs-string">&quot;nom&quot;</span>:<span class="hljs-string">&quot;Egypte&quot;</span>,
        <span class="hljs-string">&quot;capitale&quot;</span>:<span class="hljs-string">&quot;Le Caire&quot;</span>,
        <span class="hljs-string">&quot;continent&quot;</span>:<span class="hljs-string">&quot;Afrique&quot;</span>
    },{
        <span class="hljs-string">&quot;nom&quot;</span>:<span class="hljs-string">&quot;Chine&quot;</span>,
        <span class="hljs-string">&quot;capitale&quot;</span>:<span class="hljs-string">&quot;Pékin&quot;</span>,
        <span class="hljs-string">&quot;continent&quot;</span>:<span class="hljs-string">&quot;Asie&quot;</span>
    }]
    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;pages/tous_pays.html&quot;</span>, donnees=donnees, sous_titre=<span class="hljs-string">&quot;Tous les pays&quot;</span>)

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/pays/&lt;string:nom&gt;&quot;</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">pays_specifique</span>(<span class="hljs-params">nom</span>):
    grandes_villes = []
    <span class="hljs-keyword">if</span> nom ==<span class="hljs-string">&#x27;France&#x27;</span>:
        grandes_villes = [<span class="hljs-string">&#x27;Paris&#x27;</span>, <span class="hljs-string">&#x27;Lyon&#x27;</span>, <span class="hljs-string">&#x27;Marseille&#x27;</span>]
    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;pages/pays.html&quot;</span>, pays=nom, grandes_villes=grandes_villes, sous_titre=nom)
</code></pre>
<p>Afin de renvoyer vers la page du pays, il faut créer un lien vers <code>/pays/&lt;string:nom&gt;</code> dans le tableau de la page <code>/pays</code>. Ce lien est créé dans le template grâce à la fonction <code>url_for()</code>. Le premier argument de cette fonction est le nom de la fonction Python associée à une route Flask -- et non le nom de la route elle-même --; les autres arguments sont les paramètres nécessaires au fonctionnement de la fonction. <strong>Aucune URL ne doit être écrite en dur dans le code</strong>, ainsi, pour appeler <code>localhost:5000/pays/France</code>, il faut écrire <code>url_for(pays_specifique, nom=&quot;France&quot;)</code>.</p>
<pre><code class="language-html"><span class="hljs-comment">&lt;!-- pages/tous_pays.html --&gt;</span>
{%for pays in donnees%}
   <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span>{{loop.index}}<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{{url_for(&#x27;pays_specifique&#x27;, nom=pays.nom)}}&quot;</span>&gt;</span>{{pays.nom}}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{pays.capitale}}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{pays.continent}}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
{%endfor%}
</code></pre>
<p><em>Note</em>: Il ne devra y avoir aucune URL absolue dans les devoirs, les liens internes doivent s'écrire avec <code>url_for()</code>: si l'on décide de modifier le nom de la route, ou son chemin, seul <code>app.route()</code> sera impacté et l'on n'aura pas à réécrire tous nos liens dans les templates.</p>
<p><em>Exemple concerné</em>: <a href="https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/tree/master/Seance2/url_for">Seance2/url_for</a></p>
<h3 id="les-statiques-css-et-js-">Les statiques: CSS et JS <a id="statiques"></a></h3>
<p>Jusqu'à présent, nous avons vu comment importer du JS ou du CSS depuis une URL externe. Mais il est parfois nécessaire d'uiliser du CSS ou du JS maisons: ce sont des assets pour Flask, ou encore des fichiers statiques. Ces fichiers sont rangés dans le dossier <code>app/statics/</code> comme le montre l'arbre suivant:</p>
<pre><code class="language-tree">| app
|  |-- statics
|  |  |-- css
|  |  |  |-- css.css
|  |  |-- js
|  |  |  |-- js.js
|  |  |-- img
</code></pre>
<p>A la différence des templates, le dossier des statiques n'est pas un module, simplement un dossier de rangements de fichiers (CSS, JS, données, images, etc.) nécessaires au bon fonctionnement de l'application.
Si l'on nomme le dossier <code>static</code>, Flask comprendra par défaut qu'il doit y chercher les fichiers qu'on appelera par la suite dans l'application. Si le dossier est nommé autrement, comme <code>statics</code>, il va falloir l'indiquer, comme pour les templates, dans l'initialisation de Flask dans <code>app.py</code>.</p>
<pre><code class="language-python"><span class="hljs-comment"># app.py</span>
...
app = Flask(
    __name__, 
    template_folder=<span class="hljs-string">&#x27;templates&#x27;</span>,
    static_folder=<span class="hljs-string">&#x27;statics&#x27;</span>)
...
</code></pre>
<p>Maintenant que nous avons un fichier CSS dans les statics, il faut l'importer dans les templates, ou plutôt dans le HTML. Cet import se fait via une balise <code>&lt;link ...&gt;</code> dans le <code>&lt;head&gt;&lt;/head&gt;</code>. Le meilleur endroit pour importer un CSS statique est le template <code>partials/css.html</code>:</p>
<ul>
<li>on n'a à écrire l'import de <code>statics/css/font-awesome.css</code> qu'une seule fois dans notre application (dans <code>partials/css.html</code>)</li>
<li><code>partials/css.html</code> est le template logique pour l'y mettre</li>
<li>comme c'est un template, il faut penser à utiliser le <code>url_for()</code></li>
</ul>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{{ url_for(&#x27;static&#x27;, filename=&#x27;css/font-awesome.css&#x27;)}}&quot;</span>&gt;</span>
</code></pre>
<p><em>Remarque</em>: si l'on regarde les logs de Flask, on remarque que l'import d'une ressource statique interne est en réalité un appel GET de cette ressource sur le serveur</p>
<pre><code class="language-bash">127.0.0.1 - - [06/Nov/2022 16:13:31] <span class="hljs-string">&quot;GET /pays HTTP/1.1&quot;</span> 200 -
127.0.0.1 - - [06/Nov/2022 16:13:31] <span class="hljs-string">&quot;GET /statics/css/font-awesome.css HTTP/1.1&quot;</span> 200 -
</code></pre>
<p><em>Exemple concerné</em>: <a href="https://github.com/MaximeChallon/CoursM2TNAH_Flask_code/tree/master/Seance2/statics">Seance2/statics</a></p>

        
        <script async type="text/javascript">
/* From extension marp-team.marp-vscode */
(()=>{var G=Object.defineProperty;var d=($,M)=>G($,"name",{value:M,configurable:!0});(()=>{var $={676:(g,f,h)=>{g.exports=h(185)},185:(g,f)=>{"use strict";var h;h={value:!0};const S={h1:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"1"},style:"display: block; font-size: 2em; margin-block-start: 0.67em; margin-block-end: 0.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h2:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"2"},style:"display: block; font-size: 1.5em; margin-block-start: 0.83em; margin-block-end: 0.83em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h3:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"3"},style:"display: block; font-size: 1.17em; margin-block-start: 1em; margin-block-end: 1em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h4:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"4"},style:"display: block; margin-block-start: 1.33em; margin-block-end: 1.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h5:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"5"},style:"display: block; font-size: 0.83em; margin-block-start: 1.67em; margin-block-end: 1.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h6:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"6"},style:"display: block; font-size: 0.67em; margin-block-start: 2.33em; margin-block-end: 2.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},span:{proto:()=>HTMLSpanElement},pre:{proto:()=>HTMLElement,style:"display: block; font-family: monospace; white-space: pre; margin: 1em 0; --marp-auto-scaling-white-space: pre;"}},_="data-marp-auto-scaling-svg",p="data-marp-auto-scaling-container";class c extends HTMLElement{constructor(){super(),this.svgPreserveAspectRatio="xMinYMid meet";const s=d(r=>([n])=>{const{width:e,height:t}=n.contentRect;this[r]={width:e,height:t},this.updateSVGRect()},"e");this.attachShadow({mode:"open"}),this.containerObserver=new ResizeObserver(s("containerSize")),this.wrapperObserver=new ResizeObserver((...r)=>{s("wrapperSize")(...r),this.flushSvgDisplay()})}static get observedAttributes(){return["data-downscale-only"]}connectedCallback(){var s,r,n,e,t;this.shadowRoot.innerHTML=`
<style>
  svg[${_}] { display: block; width: 100%; height: auto; vertical-align: top; }
  span[${p}] { display: table; white-space: var(--marp-auto-scaling-white-space, nowrap); width: max-content; }
</style>
<div data-marp-auto-scaling-wrapper>
  <svg part="svg" ${_}>
    <foreignObject><span ${p}><slot></slot></span></foreignObject>
  </svg>
</div>
    `.split(/\n\s*/).join(""),this.wrapper=(s=this.shadowRoot.querySelector("div[data-marp-auto-scaling-wrapper]"))!==null&&s!==void 0?s:void 0;const i=this.svg;this.svg=(n=(r=this.wrapper)===null||r===void 0?void 0:r.querySelector(`svg[${_}]`))!==null&&n!==void 0?n:void 0,this.svg!==i&&(this.svgComputedStyle=this.svg?window.getComputedStyle(this.svg):void 0),this.container=(t=(e=this.svg)===null||e===void 0?void 0:e.querySelector(`span[${p}]`))!==null&&t!==void 0?t:void 0,this.observe()}disconnectedCallback(){this.svg=void 0,this.svgComputedStyle=void 0,this.wrapper=void 0,this.container=void 0,this.observe()}attributeChangedCallback(){this.observe()}flushSvgDisplay(){const{svg:s}=this;s&&(s.style.display="inline",requestAnimationFrame(()=>{s.style.display=""}))}observe(){this.containerObserver.disconnect(),this.wrapperObserver.disconnect(),this.wrapper&&this.wrapperObserver.observe(this.wrapper),this.container&&this.containerObserver.observe(this.container),this.svgComputedStyle&&this.observeSVGStyle(this.svgComputedStyle)}observeSVGStyle(s){const r=d(()=>{const n=(()=>{const e=s.getPropertyValue("--preserve-aspect-ratio");return e?e.trim():`x${(({textAlign:t,direction:i})=>{if(t.endsWith("left"))return"Min";if(t.endsWith("right"))return"Max";if(t==="start"||t==="end"){let a=i==="rtl";return t==="end"&&(a=!a),a?"Max":"Min"}return"Mid"})(s)}YMid meet`})();n!==this.svgPreserveAspectRatio&&(this.svgPreserveAspectRatio=n,this.updateSVGRect()),s===this.svgComputedStyle&&requestAnimationFrame(r)},"t");r()}updateSVGRect(){var s,r,n,e,t,i,a;let m=Math.ceil((r=(s=this.containerSize)===null||s===void 0?void 0:s.width)!==null&&r!==void 0?r:0);const v=Math.ceil((e=(n=this.containerSize)===null||n===void 0?void 0:n.height)!==null&&e!==void 0?e:0);this.dataset.downscaleOnly!==void 0&&(m=Math.max(m,(i=(t=this.wrapperSize)===null||t===void 0?void 0:t.width)!==null&&i!==void 0?i:0));const y=(a=this.svg)===null||a===void 0?void 0:a.querySelector(":scope > foreignObject");if(y?.setAttribute("width",`${m}`),y?.setAttribute("height",`${v}`),this.svg&&(this.svg.setAttribute("viewBox",`0 0 ${m} ${v}`),this.svg.setAttribute("preserveAspectRatio",this.svgPreserveAspectRatio),this.svg.style.height=m<=0||v<=0?"0":""),this.container){const k=this.svgPreserveAspectRatio.toLowerCase();this.container.style.marginLeft=k.startsWith("xmid")||k.startsWith("xmax")?"auto":"0",this.container.style.marginRight=k.startsWith("xmi")?"auto":"0"}}}d(c,"n");const o=d((l,{attrs:s={},style:r})=>class extends l{constructor(...n){super(...n);for(const[e,t]of Object.entries(s))this.hasAttribute(e)||this.setAttribute(e,t);this.attachShadow({mode:"open"})}static get observedAttributes(){return["data-auto-scaling"]}connectedCallback(){this._update()}attributeChangedCallback(){this._update()}_update(){const n=r?`<style>:host { ${r} }</style>`:"";let e="<slot></slot>";const{autoScaling:t}=this.dataset;t!==void 0&&(e=`<marp-auto-scaling exportparts="svg:auto-scaling" ${t==="downscale-only"?"data-downscale-only":""}>${e}</marp-auto-scaling>`),this.shadowRoot.innerHTML=n+e}},"s");let u;const b=Symbol(),q="marpitSVGPolyfill:setZoomFactor,",V=Symbol();let A,C;function P(l){const s=typeof l=="object"&&l.target||document,r=typeof l=="object"?l.zoom:l;window[V]||(Object.defineProperty(window,V,{configurable:!0,value:!0}),window.addEventListener("message",({data:e,origin:t})=>{if(t===window.origin)try{if(e&&typeof e=="string"&&e.startsWith(q)){const[,i]=e.split(","),a=Number.parseFloat(i);Number.isNaN(a)||(C=a)}}catch(i){console.error(i)}}));let n=!1;Array.from(s.querySelectorAll("svg[data-marpit-svg]"),e=>{var t,i,a,m;e.style.transform||(e.style.transform="translateZ(0)");const v=r||C||e.currentScale||1;A!==v&&(A=v,n=v);const y=e.getBoundingClientRect(),{length:k}=e.children;for(let L=0;L<k;L+=1){const x=e.children[L];if(x.getScreenCTM){const w=x.getScreenCTM();if(w){const N=(i=(t=x.x)===null||t===void 0?void 0:t.baseVal.value)!==null&&i!==void 0?i:0,W=(m=(a=x.y)===null||a===void 0?void 0:a.baseVal.value)!==null&&m!==void 0?m:0,B=x.children.length;for(let T=0;T<B;T+=1){const j=x.children[T];if(j.tagName==="SECTION"){const{style:O}=j;O.transformOrigin||(O.transformOrigin=`${-N}px ${-W}px`),O.transform=`scale(${v}) matrix(${w.a}, ${w.b}, ${w.c}, ${w.d}, ${w.e-y.left}, ${w.f-y.top}) translateZ(0.0001px)`;break}}}}}}),n!==!1&&Array.from(s.querySelectorAll("iframe"),({contentWindow:e})=>{e?.postMessage(`${q}${n}`,window.origin==="null"?"*":window.origin)})}d(P,"p");function z({once:l=!1,target:s=document}={}){const r=navigator.vendor==="Apple Computer, Inc."?[P]:[];let n=!l;const e=d(()=>{for(const t of r)t({target:s});n&&window.requestAnimationFrame(e)},"s");return e(),()=>{n=!1}}d(z,"h"),A=1,C=void 0;const E=Symbol(),H=d((l=document)=>{if(typeof window>"u")throw new Error("Marp Core's browser script is valid only in browser context.");if(((e=document)=>{const t=window[b];t||customElements.define("marp-auto-scaling",c);for(const i of Object.keys(S)){const a=`marp-${i}`,m=S[i].proto();u!=null||(u=!!document.createElement("div",{is:"marp-auto-scaling"}).outerHTML.startsWith("<div is")),u&&m!==HTMLElement?t||customElements.define(a,o(m,{style:S[i].style}),{extends:i}):(t||customElements.define(a,o(HTMLElement,S[i])),e.querySelectorAll(`${i}[is="${a}"]`).forEach(v=>{v.outerHTML=v.outerHTML.replace(new RegExp(`^<${i}`,"i"),`<${a}`).replace(new RegExp(`</${i}>$`,"i"),`</${a}>`)}))}window[b]=!0})(l),l[E])return l[E];const s=z({target:l}),r=d(()=>{s(),delete l[E]},"a"),n=Object.assign(r,{cleanup:r,update:()=>H(l)});return Object.defineProperty(l,E,{configurable:!0,value:n}),n},"m");f.browser=H,h=H,h=z}},M={};function R(g){var f=M[g];if(f!==void 0)return f.exports;var h=M[g]={exports:{}};return $[g](h,h.exports,R),h.exports}d(R,"__webpack_require__");var F={};(()=>{"use strict";var g=R(676);function f(){let p,c;const o=d(()=>{const u=document.getElementById("__marp-vscode"),b=!!u;p!==b?(document.body.classList.toggle("marp-vscode",b),b?c=(0,g.browser)():(c?.cleanup(),c=void 0),p=b):b&&c?.update(),p?(u&&h(u),S()):_()},"updateCallback");window.addEventListener("load",()=>window.setTimeout(o,100)),window.addEventListener("vscode.markdown.updateContent",o),o()}d(f,"preview");const h=d(p=>{p.querySelectorAll("[is]").forEach(c=>{if(c.nodeName.includes("-")||document.createElement(c.nodeName).constructor!==c.constructor)return;const{outerHTML:u}=c;c.outerHTML=u,console.debug("[marp-vscode] Custom element has been upgraded forcibly:",u.slice(0,u.indexOf(">")+1||void 0))})},"forceUpgradeCustomElements"),S=d(()=>{const p=document.querySelectorAll("style:not(#__marp-vscode-style):not(#_defaultStyles):not([data-marp-vscode-body])"),c=document.querySelectorAll('link[rel="stylesheet"][href]:not([href*="marp-vscode"])');p.forEach(o=>{o.closest("#__marp-vscode")||(o.dataset.marpVscodeBody=o.textContent??"",o.textContent="")}),c.forEach(o=>{if(o.closest("#__marp-vscode"))return;const{href:u}=o;o.dataset.marpVscodeHref=u,o.removeAttribute("href")})},"removeStyles"),_=d(()=>{const p=document.querySelectorAll("style[data-marp-vscode-body]"),c=document.querySelectorAll("link[data-marp-vscode-href]");p.forEach(o=>{o.textContent=o.dataset.marpVscodeBody||"",delete o.dataset.marpVscodeBody}),c.forEach(o=>{o.href=o.dataset.marpVscodeHref||"",delete o.dataset.marpVscodeHref})},"restoreStyles");f()})()})();})();

</script>

    </body>
    </html>